---
title: "プログラミング一般的な考え方（MUST DO , MUST NOT DO)"
author: "坂本航太"
categories: [SAS,解析プログラミング]
date-modified: "2025-06-24"
abstract-title: Abstract
abstract: ""
date: "2025-06-25"
---

## SASプログラミングTipsについてまとめます。

本記事では、組織でSASプログラミングを実行する際に、注意すべきことをまとめます。また初学者向けにPitfall and Bad Habitsについてまとめます。

引用：

-   [Good Programming Practices in Clinical Trial – a Check Program](https://www.lexjansen.com/pharmasug/2006/ApplicationsDevelopment/AD17.pdf)
-   [How Not to SAS: Avoiding Common Pitfalls and Bad Habits](https://www.lexjansen.com/pharmasug/2025/AP/PharmaSUG-2025-AP-039.pdf)

Abstract

-   Large pharmaceutical companies typically have many programmers, data managers and statisticians producing trial analysis and reporting programs. Each of these has their own style in programming. Unfortunately, such a large variety in program styles can lead to problems in the quality, readability, verifiability and maintainability of the program code.

-   Establishing a central standard, or guideline, for good programming practices (GPP) is therefore a necessary first step for large companies. By requiring all programs to meet the GPP guideline, we can insure that we produce high quality programs that are easily readable by others, can be verified easily and can be easily maintained.

ということで、MUST DO、MUST NOT DO、AVOID、RECCOMENTを組織として決めたら良い。

+-----------------+---------------------------------------------------------------------------------------------------------------------------------------------------------+
| カテゴリ        | 説明                                                                                                                                                    |
+=================+=========================================================================================================================================================+
| **MUST DO**     | These requirements for coding style and techniques **must** be met in the program.                                                                      |
+-----------------+---------------------------------------------------------------------------------------------------------------------------------------------------------+
| **MUST NOT DO** | The styles and techniques in this category **must not** be used in the program.                                                                         |
+-----------------+---------------------------------------------------------------------------------------------------------------------------------------------------------+
| **AVOID**       | The styles and techniques items in this category **should not** be used in the program.                                                                 |
+-----------------+---------------------------------------------------------------------------------------------------------------------------------------------------------+
| **RECOMMEND**   | The styles and techniques items in this category **should be** used in order to promote good readability, verifiability, maintainability and efficiency |
+-----------------+---------------------------------------------------------------------------------------------------------------------------------------------------------+

## Must Do and Must Not Do Categories

### MUST DO

+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| 項目                                                                                                                                                                                                                                                                                |
+=====================================================================================================================================================================================================================================================================================+
| Make a backup copy of the program prior to updates (Not checked by the program).                                                                                                                                                                                                    |
|                                                                                                                                                                                                                                                                                     |
| プログラムはフォルダとして、yyyymmddで日付管理をしましょう。1つのフォルダで管理するのは間違っています。                                                                                                                                                                             |
|                                                                                                                                                                                                                                                                                     |
| 都度、プログラムを実行する際にフォルダを移動させましょう。注意点：プロジェクトのプログラムが開発が終了したら、最後は1つのプログラムで全プログラムが実行されて、.rtfで解析帳票が出てくるようにしましょう。途中でExcelに吐き出してExcelで結果を加工するのはご法度です。ありえません。 |
+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Use program documentation, e.g. Headers and Comments. Write documentation in English. Imbedded comments within the body of the program code should detail the modular flow.                                                                                                         |
|                                                                                                                                                                                                                                                                                     |
| これも大事です。手動でHeadersをつけるの大変ですので、自動化させましょう。ただし、プログラム内にはコメントを残すのが良いです。                                                                                                                                                       |
+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Typically, write only one SAS® statement per line.                                                                                                                                                                                                                                  |
+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Use indentation to arrange the code clearly.                                                                                                                                                                                                                                        |
+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Use unique names for datasets and files within the program / macro.                                                                                                                                                                                                                 |
|                                                                                                                                                                                                                                                                                     |
| これも大事です。var、tmpが楽でよいですが、きちんと名前をつけましょう。                                                                                                                                                                                                              |
+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Reference datasets and/or files explicitly in each step or proc.                                                                                                                                                                                                                    |
|                                                                                                                                                                                                                                                                                     |
| 1つの帳票に対して原則1つのプログラムです。                                                                                                                                                                                                                                          |
+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Display 'Draft' in the output before program validation.                                                                                                                                                                                                                            |
|                                                                                                                                                                                                                                                                                     |
| これもいいですね。1人でやるのは悩ましいが。                                                                                                                                                                                                                                         |
+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Reset global options to original settings – if changed by the program / macro.                                                                                                                                                                                                      |
|                                                                                                                                                                                                                                                                                     |
| global optionsやproc datasetでwork フォルダを空にしたりlogをresetしましょう。                                                                                                                                                                                                       |
+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Delete all temporary datasets after program execution.                                                                                                                                                                                                                              |
|                                                                                                                                                                                                                                                                                     |
| 上と同じ考えですね。                                                                                                                                                                                                                                                                |
+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Use 'RUN;' or 'QUIT;' at the end of each data step / proc.                                                                                                                                                                                                                          |
|                                                                                                                                                                                                                                                                                     |
| これは基本です。                                                                                                                                                                                                                                                                    |
+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Use defensive coding.                                                                                                                                                                                                                                                               |
|                                                                                                                                                                                                                                                                                     |
| よく分かりません。                                                                                                                                                                                                                                                                  |
+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Display the name of the program on the output when running outside of RAGE (our document control system).                                                                                                                                                                           |
+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Optimize the data. Do not re-read data.                                                                                                                                                                                                                                             |
+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+

### MUST NOT DO

+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| 項目                                                                                                                                                                    |
+=========================================================================================================================================================================+
| Hard-Code data.                                                                                                                                                         |
|                                                                                                                                                                         |
| 手で記載するのをやめましょう。表のheaderやグラフにおけるY軸、X軸のlength等はマクロ変数、Rであれば事前にベクトルにしておきましょう。                                     |
|                                                                                                                                                                         |
| /\* ハードコードの悪い例 \*/ data work.sales_analysis; set mylib.sales_data; where year = 2024 and region = 'Tokyo'; /\* 年度と地域を直接記述 \*/                       |
|                                                                                                                                                                         |
| /\* 固定値を直接計算に使用 \*/ bonus = salary \* 0.15; /\* ボーナス率15%をハードコード \*/                                                                              |
|                                                                                                                                                                         |
| /\* ファイルパスをハードコード \*/ if \_n\_ = 1 then call symputx('output_path', 'C:\\Reports\\sales_2024.xlsx'); run;                                                  |
|                                                                                                                                                                         |
| /\* マクロ変数で設定値を管理 \*/ %let target_year = 2024; %let target_region = Tokyo; %let bonus_rate = 0.15; %let output_dir = C:\\Reports; %let library_name = mylib; |
|                                                                                                                                                                         |
| /\* または外部設定ファイルから読み込み \*/ %include "C:\\Config\\sas_config.sas";                                                                                       |
|                                                                                                                                                                         |
| data work.sales_analysis; set &library_name..sales_data; where year = &target_year and region = "&target_region";                                                       |
|                                                                                                                                                                         |
| /\* マクロ変数を使用 \*/ bonus = salary \* &bonus_rate; run;                                                                                                            |
|                                                                                                                                                                         |
| /\* 動的なファイル名生成 \*/ %let output_file = &output_dir.\\sales\_&target_year..xlsx;                                                                                |
|                                                                                                                                                                         |
| proc export data=work.sales_analysis outfile="&output_file" dbms=xlsx replace; run;                                                                                     |
+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Manually edit output.                                                                                                                                                   |
|                                                                                                                                                                         |
| これは論外です。どんな理由であれ解析結果を手で直すことはあってはなりません。                                                                                            |
|                                                                                                                                                                         |
| 上のHard codingと同様に事前にマクロ変数やベクトルで準備しておきましょう。                                                                                               |
+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Overwrite input data.                                                                                                                                                   |
|                                                                                                                                                                         |
| これはlibname statementにおいて、readonly optionをつけておきましょうか。                                                                                                |
+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Use macro names that are already used by CARE Standard macros (our standardized reporting macros)                                                                       |
|                                                                                                                                                                         |
| 既にあるマクロと同じ名前は利用してはいけません。                                                                                                                        |
+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Use of SAS® keywords for dataset and variable names.                                                                                                                    |
+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------+

Any programmers that have supported clinical trial analysis and reporting understand the complexity of derived datasets that are ready to produce tables and graphs for efficacy and safety analysis. Taking data from several domains, many-to-many merging, transposing data, imputing dates and values, averaging within visits for duplicate results, and creating intermediate datasets for the final ADaM are more complex than we expect.

## 参考

-   [Challenges in Implementing ADaM datasets: Balancing the Analysis-Ready and Traceability Concepts](https://www.lexjansen.com/pharmasug/2011/CD/PharmaSUG-2011-CD19.pdf)
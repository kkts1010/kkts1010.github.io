---
title: "臨床試験のサンプルサイズ設計"
author: "坂本航太"
date: "2025-05-17"
date-modified: "2025-05-18"
categories: [臨床試験,SAS]
abstract-title: Abstract
abstract: "私が頻用する基本的なサンプルサイズ設計について解説します。"
---

# 実務で利用するサンプルサイズ設計

本書は、頻繁に利用されるサンプルサイズ設計SASプログラムをまとめます。実務において、本記事のSASプログラムをコピーして利用することのみを念頭に置いています。数学的な導出は省略します。

# 目次　

-   0章：はじめに
    -   比較の形式
        -   優越性を示すための試験
        -   同等性又は非劣性を示すための試験
-   1章：単群試験
    -   2値アウトカム
-   並行群間比較計画
    -   2値アウトカム
    -   連続量アウトカム
    -   生存時間アウトカム

# 単群試験

## 2値アウトカム

単群試験で2値アウトカムの場合、サンプルサイズは、H0（閾値奏効割合）、H1（期待奏効割合）、α（第一種の過誤確率）、β（第二種の過誤確率）を事前に仮定することで計算できます。閾値奏効割合とは、これ以上の奏効割合がなければ治療効果がないと考えられる割合のことです。期待奏効割合とは、治療効果があると考えられる割合のことです。臨床仮説や先行研究に基づいて決定するため、試験統計家がコメントすることはあまりません。H1について、両側検定として両側有意水準5%検定としています。これは、ICH E9に準拠しており、ICH E9では以下のような記載があります。すなわち、GCP準拠の治験においては原則として以下の記載に準じて試験計画を考える。

「規制上の観点から、本ガイドラインの施行に伴い、原則として片側仮説を検証する場合は2.5％、両側仮説の場合は5％とすることとした。」

ただし、ICH E9にはQ＆AがありQ2で有意水準について言及されている。

::: callout-note
## Q2

片側検定又は両側検定のどちらを用いるか、またそこでの有意水準をいくらにすべき
かを、優越性試験と非劣性試験のそれぞれで説明願いたい。

(答)
ガイドラインでは、同等性を示す場合には両側信頼区間、非劣性試験では片側信頼
区間による解析を行うことが記載されているが、一般には推測を片側と考えるか両側
と考えるかには議論があり一概に決められるものではないとされている。また、有意
水準についても、個々の試験において適切な基準を設定すべきである旨の記載がある。
しかしながら、推論を片側とするか両側とするかにより統計的な判断に大きな差異
が生じることは規制上の観点から望ましくない。また、一方で、臨床試験における有
効性の評価では、検定により有意差があるか否かを判断するだけでなく、試験治療効
果の大きさ(比較群間の差の大きさ)がどの程度であるかを推定することも重要である。
そこで、今後は、検証的試験においては、仮説の検定においてどちらの方法を用いる
場合であっても、効果の推定には95％信頼係数の両側信頼区間を用い、検定の際の有水準は、これによる判断との整合性を図るため、優越性試験、非劣性試験のいずれにおいても、片側2.5％又は両側5％とすることを原則とする。用量反応試験についても、用量反応性を示すことにより薬剤の有効性を検証するような試験においては上記と同様である。ただし、適切な説明ができるのであれば、より強固な有効性の根拠を
示すために有意水準を厳しくする、稀少疾病用医薬品にみられる例のように十分な被
験者を集めることが困難な場合は有意水準を緩くする、などの措置をとってもよい。
なお、生物学的同等性試験については、「後発医薬品の生物学的同等性試験ガイドライン(平成9年12月22日医薬審第487号)」により、90％信頼係数の両側信頼区間を用いるとされているが、臨床効果を指標に標準製剤との同等性を検証しようとする場合(臨床的同等性試験)は、上記と同様に95％信頼係数の両側信頼区間を用いることを原則とする。
:::

　特に重要なのは、「適切な説明ができるのであれば、より強固な有効性の根拠を示すために有意水準を厳しくする、稀少疾病用医薬品にみられる例のように十分な被験者を集めることが困難な場合は有意水準を緩くする、などの措置をとってもよい。」の記載である。すなわち、両側10%や片側5%も、きちんと説明をして納得していただければ許容されるということである。これらの【5%か2.5%か】の議論については、以下のJCOGプロトコールマニュアルにも記載がある。

::: callout-tip
## JCOGプロトコール

国立がん研究センターでの第2相相当の臨床試験では、片側検定を用いることもありえます。これは、標準治療 vs 試験治療であり、少なくとも試験治療が標準治療より劣っているとは考えておらず、片側検定の方が適切と考えられるからです。 JCOGのプロトコールマニュアルのURLは以下です。 [JCOGプロトコールマニュアル](https://jcog.jp/doctor/tool/manual/)
:::

試験計画時の例：

-   H0: p = 0.1（閾値奏効割合）

-    H1: p ≠ 0.3（期待奏効割合）

-    α = 0.05（第一種の過誤、片側）

-    β = 0.2（第二種の過誤）


以下は、正規近似を用いたサンプルサイズ計算の例です。 連続修正は行いません。正規近似に基づく症例数設計では、H0におけるp0を用いて分散が計算されている点に注意してください。

実務上では、抗がん剤の単群試験では中間解析を事前に規定して、無効中止や有効中止を考慮する必要がある場合もある。そのような場合は、単純な2値データの割合のサンプルサイズ設計では実施できず、適切な試験統計家がSimonの2段階デザインやFlemingの2段階デザインを用いて例数設計をすべきである。単群試験において、ベイズ流の例数設計も提案されていることから、ベイズ流例数設計も考慮していただきたい。なお、中間解析やベイズ流例数設計は常に必要ではなく、SASでの実装はシンプルではないため、ここでは割愛します。別記事で説明します。 

``` sas
proc power;
onesamplefreq test=z
    method = normal
    sides = 2
    alpha = 0.05
    nullproportion = 0.1
    proportion = 0.3
    ntotal = .
    power = 0.8;
run;
```

Nが多い場合、N = 50相当（主観）では、上記の正規分布に基づく方法でも良いと考えます。しかし、一般的に2項分布による正確な検定に基づく症例数設計を利用することが標準的な方法です。理由は正規近似による例数設計が二項分布の中心極限定理を用いているため、あくまでＮが十分大きい状況における中心極限定理を仮定しているためです。中心極限定理を利用せず、2項分布を用いて症例数設計をするSASプログラムは以下となる。

``` sas
proc power;
    onesamplefreq test=exact
        sides = 2
        alpha = 0.05
        nullproportion = 0.1
        proportion = 0.3
        ntotal = 30.
        power = .;
        plot x = n min =2 max = 100 step = 1 yopts = (ref  = 0.8);
run;
```

上記のプログラムを実行すると、必要症例数に対して検出力は単調増加にならず、test = normalと異なり、N = xxのように数値が出力されません。そのため、SASの出力を結果を見ながら、目標とする検出力を満たす最小の整数値 or 目標とする検出力を満たす最大の整数値とします。個人的には、より保守的であるため後者を推奨します。実際、より大きなサンプルサイズを選ぶことで、検出力の目標値をより確実に達成できる可能性が高まります。ただし、リソースの制約がある場合は、目標検出力を満たす最小の症例数を選ぶことも実用的な選択肢となり得ます。どちらのアプローチを取るかは、研究の目的やリソースの制約によって相談の上、決定してください。

# 並行群間比較計画

## 連続量アウトカム

連続量アウトカムの場合、サンプルサイズは以下の式で計算できます。 以下では優越性を示す検証的試験を想定しています。

``` sas
proc power;
    twosamplemeans test=diff
        meandiff = 0.5
        stddev = 1
        alpha = 0.05
        power = 0.8
        nptotal = .;
run;
```

複数の状況をまとめて計算する場合は、以下のようにします。

``` sas
proc power;
    twosamplemeans test=diff
        meandiff = 0.5 , 1 , 1.5
        stddev = 1 , 2 , 3
        alpha = 0.05
        power = 0.8
        ntotal = .;
run;
```
平均値の差の検定は一般的であり、連続量のアウトカムを用いた試験では最も多く利用される方法です。平均値の差の検定は、通常、正規分布に従うと仮定される連続量データに適用されます。連続量アウトカムにおける経時測定データのサンプルサイズ設計が求められることもあるかと思います。その場合、最終観察時点における平均値の差を検定する方法として上記のプログラムを利用することが保守的で望ましいと考えます。例数設計としてはt検定に基づきより保守的なサンプルサイズ設計をする。統計解析においては、共分散分析やMMRMなどの同じEstimandを推定する方法で、より検出力の高い解析方法を適用することが治験の分野では求められると考えます。

## 2値アウトカム

2値アウトカムの場合、サンプルサイズは以下の式で計算できます。リスク差（割合の差）に基づいて優越性を検討することを想定しています。
p0を対照群のリスク、p1を実験群のリスクとします。リスク差は、対照群のリスクp0に基づいて計算されるため、対照群のp0を指定する必要があります。以下では、対照群のリスクp0 = 0.1、実験群のリスクp1 = 0.3、リスク差 = 0.2を想定しています。


-   H0: p1 - p0 = 0
-   H1: p1 - p0 ≠ 0
-   α = 0.05（第一種の過誤、両側）
-   β = 0.2（第二種の過誤）

SASプログラムは以下となります。ここでは、対照群のリスク及びリスク差を指定している。リスク差は、対照群のp0に基づいて計算されるため、対照群のp0を指定する必要があります。

``` sas
proc power;
twosamplefreq test=pchi
    sides = 2
    alpha = 0.05
    refproportion = 0.1
    proportiondiff = 0.2
    npergroup = .
    power = 0.8;
run;
```

## 生存時間アウトカム
生存時間アウトカムの場合、サンプルサイズは以下の式で計算できます。以下では優越性を示す検証的試験を想定しています。アウトカムはハザード比として、生存時間解析のノンパラメトリック検定（ログランク検定等）を前提とした例数設計を想定する。例えば生存時間アウトカムとして生存割合（死亡、生存）を前提として例数設計を考える場合、本節に基づく方法での例数設計も考えられるが、より保守的に2値データに基づく例数設計を行うことが望ましい場合もありえます。この違いについては、別記事で説明します。生存時間の例数設計については、SAS user総会の[SASプロシジャを用いた生存時間データに対する例数設計の変革](https://www.sas.com/content/dam/SAS/ja_jp/doc/event/sas-user-groups/usergroups2016-d-11.pdf)が参考になります。

SASのproc power twosamplesurvivalプロシジャではLakatosの方法が採用されています。これは区分指数分布を前提としており解析的にN = xxの形で表すことはできません。教育的な立場だと、解析的にN = xxの形で表すことができる方法としてFreedmanの方法やSchoenfeldの方法がありますが、上記のSASユーザー総会の資料によると、Lakatosの方法の方が性能が良いことが報告されているそうです。実務上もproc power procedureを用いて、再現可能な状態で例数設計を行うことが望ましいので、基本的にLakatosの方法を採用します。

-   H0: HR = 1
-   H1: HR ≠ 1
-   α = 0.05（第一種の過誤、両側）
-   β = 0.2（第二種の過誤）



``` sas 
proc power;
    twosamplesurvival test = logrank
    curve("Control") = 3:0.3
    curve("Experimental") = 3:0.2
    groupsurvival = "Control" | "Experimental"
    groupweights = (1 1)
    accurualtime = A followuptime = F
    ntotal = .
    power = 0.8
    alpha = 0.05;
run;
```
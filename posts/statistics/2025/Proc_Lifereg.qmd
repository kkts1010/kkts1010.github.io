---
title: "Proc LIFEREG"
author: "坂本航太"
categories: [SAS,解析プログラミング]
date-modified: "2025-07-01"
abstract-title: Abstract
abstract: ""
date: "2025-07-01"
---

# なぜPROC LIFEREGでは生存時間の「対数」をモデル化するのか？基本から徹底解説！

SASで生存時間分析を行う際、`PROC LIFEREG`のコードを見て、ふと疑問に思ったことはありませんか？

``` {.sas eval="FALSE," code-line-numbers="true," code-overflow="wrap"}
proc lifereg data=mydata;
    model log(time)*status(0) = treatment age;
run;
```

なぜ、生存時間 `time` をそのまま使わず、一手間かけて `log(time)` と対数をとるのでしょうか？ 単純に `time = treatment age;` と書くのとでは、何が違うのでしょうか？

この記事では、そんな疑問に答えるべく、`PROC LIFEREG`が`log(T)`をモデル化する理由を、統計的な背景から分かりやすく解説していきます。

## 結論ファースト：すべては美しい「線形モデル」のため

なぜ対数をとるのか？その最大の理由は、**共変量と生存時間の関係を、シンプルで扱いやすい「線形モデル」として表現するため**です。

`PROC LIFEREG`で使われるモデルの基本形は、**加速故障時間（AFT）モデル**と呼ばれ、以下のように表現されます。

$$
log(T)=\beta_0+\beta_1X_1+…+\sigma\epsilon
$$

の式こそが、すべての謎を解く鍵となります。

-   **`log(T)`**: 生存時間の対数。これがモデルの「目的変数(Y)」になります。

-   **`βX`**: `β_0 + β_1X_1 + ...` の部分。共変量（説明変数）から計算される予測部分です。

-   **`σε`**: モデルの「誤差」部分。`σ`はばらつきを調整するスケールパラメータ、`ε`は基準となる標準化された誤差です。

この「線形」という形にすることで、私たち分析者には大きなメリットがもたらされます。

## なぜ一手間かけて `log(T)` にするのか？3つの大きなメリット

### メリット1：関係性がシンプルになり、解釈しやすくなる

もし生存時間`T`を直接モデル化しようとすると、共変量`X`との関係は非常に複雑な曲線を描くことがほとんどです。しかし、`log(T)`に変換することで、その関係は美しい\*\*一次方程式（直線）\*\*になります。

これにより、「`X`が1単位増えると、生存時間の対数が`β`だけ変化する」という、非常に直感的で分かりやすい解釈が可能になるのです。

### メリット2：様々な生存時間分布を統一的に扱える

ここがAFTモデルの最もエレガントな部分です。モデルの基本形 `log(T) = βX + σε` はそのままに、**誤差項`ε`が従う確率分布を変えるだけ**で、様々な生存時間分布を表現できます。

|  |  |  |
|------------------------|------------------------|------------------------|
| `ε`が従う分布（標準化済） | `T`が従う生存時間分布 | `PROC LIFEREG`での指定 |
| **標準極値分布** | ワイブル分布 (Weibull) | `DIST=WEIBULL` (デフォルト) |
| **標準正規分布** | 対数正規分布 (Lognormal) | `DIST=LNORMAL` |
| **標準ロジスティック分布** | 対数ロジスティック分布 (Log-logistic) | `DIST=LOGISTIC` |

`log`変換は、多種多様な分布を同じ土俵で議論するための「共通言語」のような役割を果たしているのです。

## 参考：SAS helpのプログラム

[LIFEREG procedure:](https://documentation.sas.com/doc/en/statug/15.2/statug_lifereg_gettingstarted01.htm)

``` {.sas eval="FALSE," code-line-numbers="true," code-overflow="wrap"}
data Headache;
   input Minutes Group Censor @@;
   datalines;
11  1  0   12  1  0   19  1  0   19  1  0
19  1  0   19  1  0   21  1  0   20  1  0
21  1  0   21  1  0   20  1  0   21  1  0
20  1  0   21  1  0   25  1  0   27  1  0
30  1  0   21  1  1   24  1  1   14  2  0
16  2  0   16  2  0   21  2  0   21  2  0
23  2  0   23  2  0   23  2  0   23  2  0
25  2  1   23  2  0   24  2  0   24  2  0
26  2  1   32  2  1   30  2  1   30  2  0
32  2  1   20  2  1
;

proc lifereg data=Headache;
   class Group;
   model Minutes*Censor(1)=Group /dist = exponential;
   output out=New cdf=Prob;
run;
```

## SASのPROC LIFEREG徹底解説！指数分布モデルの結果を読み解く 📝

こんにちは！今回は、SASを使った生存時間分析の定番`PROC LIFEREG`の出力結果を、初心者の方にも分かりやすく解説していきます。

頭痛薬の効果持続時間を2つのグループで比較する、というシナリオで見ていきましょう。

### 今回の分析コード

まず、使用したSASコードはこちらです。

SAS

``` {.sas eval="FALSE," code-line-numbers="true," code-overflow="wrap"}
data Headache;
   input Minutes Group Censor @@;
   datalines;
11  1  0   12  1  0   19  1  0   19  1  0
19  1  0   19  1  0   21  1  0   20  1  0
21  1  0   21  1  0   20  1  0   21  1  0
20  1  0   21  1  0   25  1  0   27  1  0
30  1  0   21  1  1   24  1  1   14  2  0
16  2  0   16  2  0   21  2  0   21  2  0
23  2  0   23  2  0   23  2  0   23  2  0
25  2  1   23  2  0   24  2  0   24  2  0
26  2  1   32  2  1   30  2  1   30  2  0
32  2  1   20  2  1
;

proc lifereg data=Headache;
   class Group;
   model Minutes*Censor(1)=Group /dist = exponential;
   output out=New cdf=Prob;
run;
```

`model`ステートメントの`dist = exponential`で、今回は**指数分布**を仮定して分析しています。`Censor(1)`は、`Censor`変数の値が1の場合にそのデータが「打ち切り」であることを示します。

それでは、このコードが生成したアウトプットを上から順に見ていきましょう！

### ① モデルの基本情報と適合度

-   **分離変数の水準の情報 (Level Information for Class Variables)** `CLASS`ステートメントで指定した`Group`変数が、値として`1`と`2`を持っていることを示しています。

-   **適合度統計量 (Goodness-of-Fit Statistics)** `AIC`や`BIC`といった指標が並んでいますね。これらの値は**小さいほど、モデルの当てはまりが良い**ことを意味します。この結果だけでは評価できませんが、例えば`dist = weibull`（ワイブル分布）で分析した結果と比較して、どちらのモデルがよりデータにフィットしているかを見るために使います。

-   **アルゴリズムは収束しました。(The algorithm has converged.)** モデルの計算が問題なく完了したことを示す、重要なメッセージです。これが表示されていれば一安心です。

### ② Groupの効果はあったのか？【Type III 分析】

-   **効果に対する Type III 分析 (Type III Analysis of Effects)** ここが**最初の重要な結果**です。この表は、モデルに含まれる変数`Group`が、生存時間（頭痛薬の効果持続時間）に統計的に有意な影響を与えているかを「全体として」検定します。

    注目するのは**Pr \> ChiSq**の値です。これが、いわゆる**p値**です。

    -   **結果**: `Pr > ChiSq` = **0.2778**

    一般的にp値が0.05より小さい場合に「有意な差がある」と判断しますが、今回は0.2778と0.05より大きいです。 したがって、「**2つのグループ間で、効果持続時間に統計的に有意な差があるとは言えない**」という結論になります。

### ③ パラメータの詳細を読み解く【最大尤度パラメータ推定値】

-   **最大尤度パラメータ推定値の分析 (Analysis of Maximum Likelihood Parameter Estimates)** モデルの「中身」を詳しく見ていく部分です。

    -   **Intercept (切片)**: これは**基準となるグループ（今回はGroup 2）の対数スケールでの平均生存時間を示しています。推定値は3.5354**です。

    -   **Group 1**: これがこの分析の主役です。この行は、**基準のGroup 2と比較して、Group 1がどれだけ違うか**を示しています。

        -   **推定値**: **-0.3999**

        -   **Pr \> ChiSq (p値)**: **0.2778** p値はType III 分析の結果と一致していますね。やはり有意ではありません。

    -   **尺度 (Scale) & Weibull 形状 (Weibull shape)**: `dist = exponential`（指数分布）を指定したため、**尺度 (σ) は自動的に1に固定**されます。`Weibull 形状`は尺度の逆数（1/σ）なので、こちらも1になります。これは、正しく指数分布モデルが適用されていることを示しています。

#### パラメータの解釈

`Group 1`の推定値`-0.3999`はどう解釈すれば良いのでしょうか？ `PROC LIFEREG`は対数（log）で時間をモデル化しているので、元の時間スケールに戻すには`exp()`を使います。

exp(−0.3999)≈0.670

これは**加速因子 (Acceleration Factor)** と呼ばれ、「**Group 1の時間は、Group 2の時間の0.67倍になる**」と解釈できます。つまり、Group 1の方が効果持続時間（イベント発生までの時間）が短い傾向にある、という結果です。（ただし、この差は統計的に有意ではありませんでした。）

### まとめ

今回の分析から分かったことをまとめると、以下のようになります。

-   頭痛薬の効果持続時間について、**指数分布モデル**を適用して分析した。

-   **グループ（Group 1 vs Group 2）による持続時間の差は、統計的に有意ではなかった (p = 0.2778)**。

-   モデル上は、Group 1の効果持続時間はGroup 2の約0.67倍と、短い傾向が示唆されたが、これは偶然の範囲内と言える。

`PROC LIFEREG`の出力は一見複雑に見えますが、見るべきポイントを押さえれば、分析結果を深く理解することができます。次は`dist=weibull`を試して、AICを比較してみるのも面白いかもしれませんね！

### 群間比較が「比」になる理由

これは、モデルが`log(時間)`を扱っていることに直結します。

モデルの基本形は以下の通りです。

-   Group 2 (基準): `log(Time_G2) = Intercept`

-   Group 1: `log(Time_G1) = Intercept + β_G1`

ここで、2つの式の**差**をとってみます。

`log(Time_G1) - log(Time_G2) = β_G1`

対数の性質上、**「引き算」は「割り算」に変換**できます（`log(a) - log(b) = log(a/b)`）。

`log(Time_G1 / Time_G2) = β_G1`

最後に、両辺を`exp()`して`log`を外すと、

`Time_G1 / Time_G2 = exp(β_G1)`

この式が最終的な答えです。`Group 1`の時間と`Group 2`の時間の関係は、差（`Time_G1 - Time_G2`）ではなく\*\*比（`Time_G1 / Time_G2`）\*\*で表されていますね。

この`exp(β_G1)`が、前回解説した**加速因子 (0.67)** です。グループの効果は、基準となる時間を何倍に「加速」または「減速」させるか、という**乗法的な（掛け算の）効果**として解釈されるのです。
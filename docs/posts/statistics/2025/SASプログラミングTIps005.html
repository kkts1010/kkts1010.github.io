<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="ja" xml:lang="ja"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.30">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="坂本航太">

<title>PROGRAMMING FOR JOB SECURITY REVISITED: – Kota Sakamoto</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../../">
<script src="../../../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../../../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting-9849038e97c5862c14c4eb81893d019b.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../../site_libs/bootstrap/bootstrap-945f87a38397f0f3b8ef34e2f394b6bc.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "一致なし",
    "search-matching-documents-text": "一致した文書",
    "search-copy-link-title": "検索へのリンクをコピー",
    "search-hide-matches-text": "追加の検索結果を非表示",
    "search-more-match-text": "追加の検索結果",
    "search-more-matches-text": "追加の検索結果",
    "search-clear-button-title": "消去",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "取消",
    "search-submit-button-title": "検索",
    "search-label": "サーチ"
  }
}</script>


<link rel="stylesheet" href="../../../styles.css">
</head>

<body class="nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../../index.html">
    <span class="navbar-title">Kota Sakamoto</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="サーチ"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="ナビゲーションを切り替える" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../about.html"> 
<span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../posts/statistics/index.html"> 
<span class="menu-text">Notes</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../posts/Web_tools/Web_tools.html"> 
<span class="menu-text">Web Tools</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
    <a href="https://github.com/kkts1010/kkts1010.github.io/" title="" class="quarto-navigation-tool px-1" aria-label=""><i class="bi bi-github"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-page-left">
      <h1 class="title">PROGRAMMING FOR JOB SECURITY REVISITED:</h1>
                                <div class="quarto-categories">
                <div class="quarto-category">SAS</div>
                <div class="quarto-category">解析プログラミング</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta column-page-left">

      <div>
      <div class="quarto-title-meta-heading">作者</div>
      <div class="quarto-title-meta-contents">
               <p>坂本航太 </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">公開</div>
      <div class="quarto-title-meta-contents">
        <p class="date">2025年6月25日</p>
      </div>
    </div>
    
      <div>
      <div class="quarto-title-meta-heading">更新日</div>
      <div class="quarto-title-meta-contents">
        <p class="date-modified">2025年6月24日</p>
      </div>
    </div>
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-full page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">目次</h2>
   
  <ul class="collapse">
  <li><a href="#風刺sasプログラミングで絶対にやってはいけない悪魔の技法完全版" id="toc-風刺sasプログラミングで絶対にやってはいけない悪魔の技法完全版" class="nav-link active" data-scroll-target="#風刺sasプログラミングで絶対にやってはいけない悪魔の技法完全版"><span class="header-section-number">1</span> 【風刺】SASプログラミングで絶対にやってはいけない「悪魔の技法」完全版</a>
  <ul class="collapse">
  <li><a href="#はじめに" id="toc-はじめに" class="nav-link" data-scroll-target="#はじめに"><span class="header-section-number">1.1</span> はじめに</a></li>
  <li><a href="#プログラミングスタイルやってはいけないこと" id="toc-プログラミングスタイルやってはいけないこと" class="nav-link" data-scroll-target="#プログラミングスタイルやってはいけないこと"><span class="header-section-number">1.2</span> 🚫 プログラミングスタイル（やってはいけないこと）</a></li>
  <li><a href="#システムオプションの悪用" id="toc-システムオプションの悪用" class="nav-link" data-scroll-target="#システムオプションの悪用"><span class="header-section-number">1.3</span> 🎭 システムオプションの悪用</a></li>
  <li><a href="#編集スタイル可読性を破壊する方法" id="toc-編集スタイル可読性を破壊する方法" class="nav-link" data-scroll-target="#編集スタイル可読性を破壊する方法"><span class="header-section-number">1.4</span> 📝 編集スタイル（可読性を破壊する方法）</a></li>
  <li><a href="#コメントの悪用" id="toc-コメントの悪用" class="nav-link" data-scroll-target="#コメントの悪用"><span class="header-section-number">1.5</span> 💬 コメントの悪用</a></li>
  <li><a href="#命名規則の悪用" id="toc-命名規則の悪用" class="nav-link" data-scroll-target="#命名規則の悪用"><span class="header-section-number">1.6</span> 🔤 命名規則の悪用</a></li>
  <li><a href="#データステップの境界をぼかす技法" id="toc-データステップの境界をぼかす技法" class="nav-link" data-scroll-target="#データステップの境界をぼかす技法"><span class="header-section-number">1.7</span> 🌀 データステップの境界をぼかす技法</a></li>
  <li><a href="#さらに極端な技法上級者向け悪魔術" id="toc-さらに極端な技法上級者向け悪魔術" class="nav-link" data-scroll-target="#さらに極端な技法上級者向け悪魔術"><span class="header-section-number">1.8</span> 🔥 さらに極端な技法（上級者向け悪魔術）</a></li>
  <li><a href="#正しいプログラミング実践推奨事項" id="toc-正しいプログラミング実践推奨事項" class="nav-link" data-scroll-target="#正しいプログラミング実践推奨事項"><span class="header-section-number">1.9</span> ✅ 正しいプログラミング実践（推奨事項）</a></li>
  <li><a href="#心理的トリックと認知バイアスの悪用" id="toc-心理的トリックと認知バイアスの悪用" class="nav-link" data-scroll-target="#心理的トリックと認知バイアスの悪用"><span class="header-section-number">1.10</span> 🧠 心理的トリックと認知バイアスの悪用</a></li>
  <li><a href="#プロシージャの悪用" id="toc-プロシージャの悪用" class="nav-link" data-scroll-target="#プロシージャの悪用"><span class="header-section-number">1.11</span> 🔄 プロシージャの悪用</a></li>
  <li><a href="#マクロプログラミングの悪魔術" id="toc-マクロプログラミングの悪魔術" class="nav-link" data-scroll-target="#マクロプログラミングの悪魔術"><span class="header-section-number">1.12</span> 🎭 マクロプログラミングの悪魔術</a></li>
  <li><a href="#データアクセスとライブラリの混乱" id="toc-データアクセスとライブラリの混乱" class="nav-link" data-scroll-target="#データアクセスとライブラリの混乱"><span class="header-section-number">1.13</span> 🗃️ データアクセスとライブラリの混乱</a></li>
  <li><a href="#統計プロシージャの悪用" id="toc-統計プロシージャの悪用" class="nav-link" data-scroll-target="#統計プロシージャの悪用"><span class="header-section-number">1.14</span> 📊 統計プロシージャの悪用</a></li>
  <li><a href="#セキュリティと権限の悪用" id="toc-セキュリティと権限の悪用" class="nav-link" data-scroll-target="#セキュリティと権限の悪用"><span class="header-section-number">1.15</span> 🔒 セキュリティと権限の悪用</a></li>
  <li><a href="#オペレーティングシステム固有の悪用" id="toc-オペレーティングシステム固有の悪用" class="nav-link" data-scroll-target="#オペレーティングシステム固有の悪用"><span class="header-section-number">1.16</span> 🌐 オペレーティングシステム固有の悪用</a></li>
  <li><a href="#実際の被害例と教訓" id="toc-実際の被害例と教訓" class="nav-link" data-scroll-target="#実際の被害例と教訓"><span class="header-section-number">1.17</span> ⚠️ 実際の被害例と教訓</a></li>
  <li><a href="#まとめ" id="toc-まとめ" class="nav-link" data-scroll-target="#まとめ"><span class="header-section-number">1.18</span> まとめ</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block column-page-left" id="quarto-document-content">





<p>本記事では、以下の2つの文献をまとめる。</p>
<p>参考文献</p>
<ul>
<li><p><a href="https://support.sas.com/resources/papers/proceedings-archive/SEUGI1997/CARPENTE_TECSHOW.PDF">PROGRAMMING FOR JOB SECURITY: TIPS AND TECHNIQUES TO MAXIMIZE YOUR INDISPENSABILITY</a></p></li>
<li><p><a href="https://support.sas.com/resources/papers/proceedings/proceedings/sugi23/Training/p275.pdf">PROGRAMMING FOR JOB SECURITY REVISITED: EVEN MORE TIPS AND TECHNIQUES TO MAXIMIZE YOUR INDISPENSABILITY</a></p></li>
</ul>
<section id="風刺sasプログラミングで絶対にやってはいけない悪魔の技法完全版" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> 【風刺】SASプログラミングで絶対にやってはいけない「悪魔の技法」完全版</h1>
<blockquote class="blockquote">
<p><strong>重要</strong>: この記事は、Arthur L. Carpenter氏とTony Payne氏の風刺的な論文「Programming for Job Security」シリーズを基に、SASプログラミングのアンチパターンを紹介するものです。これらの技法は<strong>絶対に実用してはいけません</strong>。</p>
</blockquote>
<section id="はじめに" class="level2" data-number="1.1">
<h2 data-number="1.1" class="anchored" data-anchor-id="はじめに"><span class="header-section-number">1.1</span> はじめに</h2>
<p>「保守しやすいコードは少ない人員で管理できる。つまり、あなたの雇用が危険にさらされる」</p>
<p>この皮肉な視点から、意図的に読みにくく、保守困難なSASコードを書く「技法」を紹介します。もちろん、これは<strong>反面教師</strong>として学ぶべき内容です。</p>
<blockquote class="blockquote">
<p>“Don’t be irreplaceable, if you can’t be replaced, you can’t be promoted.” - Dilbert’s Laws of Work</p>
</blockquote>
</section>
<section id="プログラミングスタイルやってはいけないこと" class="level2" data-number="1.2">
<h2 data-number="1.2" class="anchored" data-anchor-id="プログラミングスタイルやってはいけないこと"><span class="header-section-number">1.2</span> 🚫 プログラミングスタイル（やってはいけないこと）</h2>
<section id="論理的分離の回避" class="level3" data-number="1.2.1">
<h3 data-number="1.2.1" class="anchored" data-anchor-id="論理的分離の回避"><span class="header-section-number">1.2.1</span> 論理的分離の回避</h3>
<div class="sourceCode" id="cb1" data-eval="FALSE," data-code-overflow="wrap"><pre class="sourceCode numberSource sas number-lines code-with-copy"><code class="sourceCode"><span id="cb1-1"><a href="#cb1-1"></a>/* 悪い例：本来分けるべき処理を無理やり1つにまとめる */</span>
<span id="cb1-2"><a href="#cb1-2"></a>data result;</span>
<span id="cb1-3"><a href="#cb1-3"></a>   set patients;</span>
<span id="cb1-4"><a href="#cb1-4"></a>   if age &lt; 18 then group='pediatric'; else group='adult';</span>
<span id="cb1-5"><a href="#cb1-5"></a>   weight_kg = weight_lb / 2.2;</span>
<span id="cb1-6"><a href="#cb1-6"></a>   bmi = weight_kg / (height_m * height_m);</span>
<span id="cb1-7"><a href="#cb1-7"></a>   if bmi &gt; 30 then obese_flag = 1; else obese_flag = 0;</span>
<span id="cb1-8"><a href="#cb1-8"></a>   /* 複数の異なる処理が混在 */</span>
<span id="cb1-9"><a href="#cb1-9"></a>run;</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><strong>解説</strong>: このコードは年齢分類、重量変換、BMI計算、肥満判定という4つの異なる処理を1つのデータステップに混在させています。本来なら機能ごとに分割すべきですが、すべてを混ぜることで何をしているのか分かりにくくしています。</p>
</section>
<section id="過度なネスト化3層以上で複雑さ倍増" class="level3" data-number="1.2.2">
<h3 data-number="1.2.2" class="anchored" data-anchor-id="過度なネスト化3層以上で複雑さ倍増"><span class="header-section-number">1.2.2</span> 過度なネスト化（3層以上で複雑さ倍増）</h3>
<div class="sourceCode" id="cb2" data-eval="FALSE," data-code-overflow="wrap"><pre class="sourceCode numberSource sas number-lines code-with-copy"><code class="sourceCode"><span id="cb2-1"><a href="#cb2-1"></a>/* 悪い例：無意味に深いネスト */</span>
<span id="cb2-2"><a href="#cb2-2"></a>date = mdy(month(date), day(date), year(date));</span>
<span id="cb2-3"><a href="#cb2-3"></a>depth2 = input(substr(station, index(station,'-')+1), 3.);</span>
<span id="cb2-4"><a href="#cb2-4"></a>name = substr(name, index(name,',')+1, length(name));</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><strong>解説</strong>:</p>
<ul>
<li><p>1行目：既にSAS日付値の変数を、わざわざ分解して再構築する無意味な処理</p></li>
<li><p>2行目：文字列から数値抽出を3つの関数で複雑にネスト</p></li>
<li><p>3行目：名前の後半部分を取得する処理を複雑化 これらは全て、より単純な方法で書けるものを意図的に複雑にしています。</p></li>
</ul>
</section>
<section id="関数の不適切な使用" class="level3" data-number="1.2.3">
<h3 data-number="1.2.3" class="anchored" data-anchor-id="関数の不適切な使用"><span class="header-section-number">1.2.3</span> 関数の不適切な使用</h3>
<div class="sourceCode" id="cb3" data-eval="FALSE," data-code-overflow="wrap"><pre class="sourceCode numberSource sas number-lines code-with-copy"><code class="sourceCode"><span id="cb3-1"><a href="#cb3-1"></a>/* 悪い例：関数で置き換え可能な処理を冗長に記述 */</span>
<span id="cb3-2"><a href="#cb3-2"></a>if a &lt; 0 then b = a*-1;</span>
<span id="cb3-3"><a href="#cb3-3"></a>else b = a;</span>
<span id="cb3-4"><a href="#cb3-4"></a>/* ABS(a)で済む処理 */</span>
<span id="cb3-5"><a href="#cb3-5"></a></span>
<span id="cb3-6"><a href="#cb3-6"></a>/* 悪い例：非標準的な書き方 */</span>
<span id="cb3-7"><a href="#cb3-7"></a>ab = (a*(a&gt;0) + b*(b&gt;0))/((a&gt;0)+(b&gt;0));</span>
<span id="cb3-8"><a href="#cb3-8"></a>/* 2つの正数の平均を求める処理 */</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><strong>解説</strong>:</p>
<ul>
<li><p>1つ目：<code>ABS(a)</code>関数で済む絶対値計算を、わざわざIF文で書いている</p></li>
<li><p>2つ目：2つの正数の平均を求めるのに、論理値を数値として使う複雑な式を使用。<code>(a+b)/2</code>で済むところを意図的に分かりにくくしている</p></li>
</ul>
</section>
<section id="マクロの悪用" class="level3" data-number="1.2.4">
<h3 data-number="1.2.4" class="anchored" data-anchor-id="マクロの悪用"><span class="header-section-number">1.2.4</span> マクロの悪用</h3>
<div class="sourceCode" id="cb4" data-eval="FALSE," data-code-overflow="wrap"><pre class="sourceCode numberSource sas number-lines code-with-copy"><code class="sourceCode"><span id="cb4-1"><a href="#cb4-1"></a>/* 悪い例：ローカル・グローバル変数の混乱 */</span>
<span id="cb4-2"><a href="#cb4-2"></a>%macro inside(aa);</span>
<span id="cb4-3"><a href="#cb4-3"></a>    %put inside &amp;aa;</span>
<span id="cb4-4"><a href="#cb4-4"></a>%mend inside;</span>
<span id="cb4-5"><a href="#cb4-5"></a></span>
<span id="cb4-6"><a href="#cb4-6"></a>%macro outside;</span>
<span id="cb4-7"><a href="#cb4-7"></a>    %let aa = 5;</span>
<span id="cb4-8"><a href="#cb4-8"></a>    %inside(3)</span>
<span id="cb4-9"><a href="#cb4-9"></a>    %put outside &amp;aa;</span>
<span id="cb4-10"><a href="#cb4-10"></a>%mend outside;</span>
<span id="cb4-11"><a href="#cb4-11"></a></span>
<span id="cb4-12"><a href="#cb4-12"></a>%outside</span>
<span id="cb4-13"><a href="#cb4-13"></a>/* 出力: inside 3, outside 5 */</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><strong>解説</strong>: マクロパラメータとマクロ変数の名前を同じにして混乱を誘発。<code>%inside(3)</code>では引数として3が渡されるため「inside 3」と出力されますが、<code>%outside</code>マクロ内の<code>&amp;aa</code>は依然として5のままです。これによりマクロ変数のスコープについて混乱を招きます。</p>
</section>
<section id="不必要な複雑化" class="level3" data-number="1.2.5">
<h3 data-number="1.2.5" class="anchored" data-anchor-id="不必要な複雑化"><span class="header-section-number">1.2.5</span> 不必要な複雑化</h3>
<div class="sourceCode" id="cb5" data-eval="FALSE," data-code-overflow="wrap"><pre class="sourceCode numberSource sas number-lines code-with-copy"><code class="sourceCode"><span id="cb5-1"><a href="#cb5-1"></a>/* 悪い例：PROC SQLを無理やり複数ステップに分解 */</span>
<span id="cb5-2"><a href="#cb5-2"></a>proc sort data=sales;</span>
<span id="cb5-3"><a href="#cb5-3"></a>    by region;</span>
<span id="cb5-4"><a href="#cb5-4"></a>proc summary data=sales nway;</span>
<span id="cb5-5"><a href="#cb5-5"></a>    by region;</span>
<span id="cb5-6"><a href="#cb5-6"></a>    var saleprce;</span>
<span id="cb5-7"><a href="#cb5-7"></a>    output out=stats mean=meansale;</span>
<span id="cb5-8"><a href="#cb5-8"></a>data report;</span>
<span id="cb5-9"><a href="#cb5-9"></a>    merge stats sales;</span>
<span id="cb5-10"><a href="#cb5-10"></a>    by region;</span>
<span id="cb5-11"><a href="#cb5-11"></a>    if saleprce gt meansale;</span>
<span id="cb5-12"><a href="#cb5-12"></a></span>
<span id="cb5-13"><a href="#cb5-13"></a>/* 本来は以下の1ステップで済む */</span>
<span id="cb5-14"><a href="#cb5-14"></a>proc sql;</span>
<span id="cb5-15"><a href="#cb5-15"></a>    create table report as</span>
<span id="cb5-16"><a href="#cb5-16"></a>    select * from sales</span>
<span id="cb5-17"><a href="#cb5-17"></a>    having saleprce gt mean(saleprce)</span>
<span id="cb5-18"><a href="#cb5-18"></a>    group by region;</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><strong>解説</strong>: 1つのSQL文で書ける処理を、わざわざSORT→SUMMARY→DATA stepの3段階に分けています。これにより一時データセット（stats）が作成され、処理が複雑になり、エラーの可能性も増加します。</p>
</section>
</section>
<section id="システムオプションの悪用" class="level2" data-number="1.3">
<h2 data-number="1.3" class="anchored" data-anchor-id="システムオプションの悪用"><span class="header-section-number">1.3</span> 🎭 システムオプションの悪用</h2>
<section id="デバッグ機能の無効化" class="level3" data-number="1.3.1">
<h3 data-number="1.3.1" class="anchored" data-anchor-id="デバッグ機能の無効化"><span class="header-section-number">1.3.1</span> デバッグ機能の無効化</h3>
<div class="sourceCode" id="cb6" data-eval="FALSE," data-code-overflow="wrap"><pre class="sourceCode numberSource sas number-lines code-with-copy"><code class="sourceCode"><span id="cb6-1"><a href="#cb6-1"></a>/* 悪い例：重要な情報を隠す */</span>
<span id="cb6-2"><a href="#cb6-2"></a>options NOSOURCE NOSOURCE2 NONOTES NOLABEL NOMACRO;</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><strong>解説</strong>:</p>
<ul>
<li><p><code>NOSOURCE</code>: 実行されたSASコードをログに表示しない</p></li>
<li><p><code>NOSOURCE2</code>: %INCLUDEで読み込まれたコードも表示しない</p></li>
<li><p><code>NONOTES</code>: 通常のNOTEメッセージを非表示</p></li>
<li><p><code>NOLABEL</code>: 変数ラベルを無効化</p></li>
<li><p><code>NOMACRO</code>: マクロ機能自体を無効化 これらによりデバッグが困難になります。</p></li>
</ul>
</section>
<section id="観測数制御の悪用" class="level3" data-number="1.3.2">
<h3 data-number="1.3.2" class="anchored" data-anchor-id="観測数制御の悪用"><span class="header-section-number">1.3.2</span> 観測数制御の悪用</h3>
<div class="sourceCode" id="cb7" data-eval="FALSE," data-code-overflow="wrap"><pre class="sourceCode numberSource sas number-lines code-with-copy"><code class="sourceCode"><span id="cb7-1"><a href="#cb7-1"></a>/* 悪い例：事前告知なしでのデータ制限 */</span>
<span id="cb7-2"><a href="#cb7-2"></a>options obs=100 firstobs=50;  /* 隠して設定 */</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><strong>解説</strong>: データセットの50-100番目の観測値のみを処理対象にしていますが、これを他の人に知らせていません。全データを処理していると思い込ませる悪質な手法です。</p>
</section>
<section id="ワークエリアの操作" class="level3" data-number="1.3.3">
<h3 data-number="1.3.3" class="anchored" data-anchor-id="ワークエリアの操作"><span class="header-section-number">1.3.3</span> ワークエリアの操作</h3>
<div class="sourceCode" id="cb8" data-eval="FALSE," data-code-overflow="wrap"><pre class="sourceCode numberSource sas number-lines code-with-copy"><code class="sourceCode"><span id="cb8-1"><a href="#cb8-1"></a>/* 悪い例：一時ファイルの場所を変更 */</span>
<span id="cb8-2"><a href="#cb8-2"></a>options user=sasuser;</span>
<span id="cb8-3"><a href="#cb8-3"></a>data new;  /* 実際はSASUSER.NEWに保存される */</span>
<span id="cb8-4"><a href="#cb8-4"></a>    set project.master;</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><strong>解説</strong>: <code>USER=</code>オプションにより、一時的なデータセット<code>NEW</code>が<code>SASUSER</code>ライブラリに保存されます。セッション終了後も残存し、ディスク容量の問題や混乱を引き起こします。</p>
</section>
<section id="危険なオプション" class="level3" data-number="1.3.4">
<h3 data-number="1.3.4" class="anchored" data-anchor-id="危険なオプション"><span class="header-section-number">1.3.4</span> 危険なオプション</h3>
<div class="sourceCode" id="cb9" data-eval="FALSE," data-code-overflow="wrap"><pre class="sourceCode numberSource sas number-lines code-with-copy"><code class="sourceCode"><span id="cb9-1"><a href="#cb9-1"></a>/* 悪い例：エラー時即座終了 */</span>
<span id="cb9-2"><a href="#cb9-2"></a>options ERRORABEND;</span>
<span id="cb9-3"><a href="#cb9-3"></a></span>
<span id="cb9-4"><a href="#cb9-4"></a>/* 悪い例：年の解釈を混乱させる */</span>
<span id="cb9-5"><a href="#cb9-5"></a>options YEARCUTOFF=1800;</span>
<span id="cb9-6"><a href="#cb9-6"></a>data a;</span>
<span id="cb9-7"><a href="#cb9-7"></a>    date = '23mar98'd;</span>
<span id="cb9-8"><a href="#cb9-8"></a>    year = year(date);  /* 1897になる */</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><strong>解説</strong>:</p>
<ul>
<li><p><code>ERRORABEND</code>: エラー発生時にSASセッションが即座に終了し、ログも確認できない</p></li>
<li><p><code>YEARCUTOFF=1800</code>: 2桁年表記の解釈基準を1800年に設定。’98’が1998年ではなく1898年と解釈される</p></li>
</ul>
</section>
<section id="sオプションによる列数制限" class="level3" data-number="1.3.5">
<h3 data-number="1.3.5" class="anchored" data-anchor-id="sオプションによる列数制限"><span class="header-section-number">1.3.5</span> S=オプションによる列数制限</h3>
<div class="sourceCode" id="cb10" data-eval="FALSE," data-code-overflow="wrap"><pre class="sourceCode numberSource sas number-lines code-with-copy"><code class="sourceCode"><span id="cb10-1"><a href="#cb10-1"></a>/* 悪い例：最初の10桁のみ読み取り */</span>
<span id="cb10-2"><a href="#cb10-2"></a>options s=10;</span>
<span id="cb10-3"><a href="#cb10-3"></a>data new;</span>
<span id="cb10-4"><a href="#cb10-4"></a>    set olddata    /* OLDDATになる */</span>
<span id="cb10-5"><a href="#cb10-5"></a>        master</span>
<span id="cb10-6"><a href="#cb10-6"></a>        adj;</span>
<span id="cb10-7"><a href="#cb10-7"></a>    profit =</span>
<span id="cb10-8"><a href="#cb10-8"></a>        sales + tax;  /* TAXが使われない */</span>
<span id="cb10-9"><a href="#cb10-9"></a>    cnt+1;  /* PROFITの計算に含まれる */</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><strong>解説</strong>: <code>S=10</code>により、各行の最初の10文字のみが読み取られます。<code>olddata</code>は<code>olddat</code>に、<code>sales + tax</code>は<code>sales +</code>のみが読まれ、変数<code>tax</code>は無視されます。また、<code>cnt+1;</code>が前の行に繋がってしまいます。</p>
</section>
</section>
<section id="編集スタイル可読性を破壊する方法" class="level2" data-number="1.4">
<h2 data-number="1.4" class="anchored" data-anchor-id="編集スタイル可読性を破壊する方法"><span class="header-section-number">1.4</span> 📝 編集スタイル（可読性を破壊する方法）</h2>
<section id="インデントの無視" class="level3" data-number="1.4.1">
<h3 data-number="1.4.1" class="anchored" data-anchor-id="インデントの無視"><span class="header-section-number">1.4.1</span> インデントの無視</h3>
<div class="sourceCode" id="cb11" data-eval="FALSE," data-code-overflow="wrap"><pre class="sourceCode numberSource sas number-lines code-with-copy"><code class="sourceCode"><span id="cb11-1"><a href="#cb11-1"></a>/* 悪い例：インデントなし */</span>
<span id="cb11-2"><a href="#cb11-2"></a>data sasclass.biomass;</span>
<span id="cb11-3"><a href="#cb11-3"></a>infile rawdat missover;</span>
<span id="cb11-4"><a href="#cb11-4"></a>input @1 STATION $</span>
<span id="cb11-5"><a href="#cb11-5"></a>@12 DATE DATE7.</span>
<span id="cb11-6"><a href="#cb11-6"></a>@20 BMPOLY</span>
<span id="cb11-7"><a href="#cb11-7"></a>@25 BMCRUS</span>
<span id="cb11-8"><a href="#cb11-8"></a>@31 BMMOL</span>
<span id="cb11-9"><a href="#cb11-9"></a>@36 BMOTHR</span>
<span id="cb11-10"><a href="#cb11-10"></a>@41 BMTOTL ;</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><strong>解説</strong>: インデントがないため、どの行がどのステートメントに属するかが分かりにくくなっています。特にINPUTステートメントの変数リストが見づらく、修正時にミスを誘発しやすくなります。</p>
</section>
<section id="複数ステートメントの詰め込み" class="level3" data-number="1.4.2">
<h3 data-number="1.4.2" class="anchored" data-anchor-id="複数ステートメントの詰め込み"><span class="header-section-number">1.4.2</span> 複数ステートメントの詰め込み</h3>
<div class="sourceCode" id="cb12" data-eval="FALSE," data-code-overflow="wrap"><pre class="sourceCode numberSource sas number-lines code-with-copy"><code class="sourceCode"><span id="cb12-1"><a href="#cb12-1"></a>/* 悪い例：1行に複数ステートメント */</span>
<span id="cb12-2"><a href="#cb12-2"></a>data new;set old;if age&gt;65 then senior=1;else senior=0;weight_kg=weight_lb/2.2;output;</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><strong>解説</strong>: 5つのステートメントを1行に詰め込んでいます。どこで1つのステートメントが終わり、次が始まるのかが分からず、デバッグや修正が困難になります。</p>
</section>
<section id="行の途中での改行" class="level3" data-number="1.4.3">
<h3 data-number="1.4.3" class="anchored" data-anchor-id="行の途中での改行"><span class="header-section-number">1.4.3</span> 行の途中での改行</h3>
<div class="sourceCode" id="cb13" data-eval="FALSE," data-code-overflow="wrap"><pre class="sourceCode numberSource sas number-lines code-with-copy"><code class="sourceCode"><span id="cb13-1"><a href="#cb13-1"></a>/* 悪い例：意味のない場所での改行 */</span>
<span id="cb13-2"><a href="#cb13-2"></a>data sasclass.biomass;infile rawdat</span>
<span id="cb13-3"><a href="#cb13-3"></a>missover;</span>
<span id="cb13-4"><a href="#cb13-4"></a>input @1 STATION $ @12 DATE DATE7.</span>
<span id="cb13-5"><a href="#cb13-5"></a>@20 BMPOLY @25 BMCRUS @31 BMMOL @36</span>
<span id="cb13-6"><a href="#cb13-6"></a>BMOTHR @41 BMTOTL ;</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><strong>解説</strong>: 文法的に意味のない場所で改行しています。<code>infile rawdat</code>と<code>missover</code>オプションが分離され、<code>input</code>ステートメントも不自然に分割されています。</p>
</section>
<section id="画面外への重要コード配置" class="level3" data-number="1.4.4">
<h3 data-number="1.4.4" class="anchored" data-anchor-id="画面外への重要コード配置"><span class="header-section-number">1.4.4</span> 画面外への重要コード配置</h3>
<div class="sourceCode" id="cb14" data-eval="FALSE," data-code-overflow="wrap"><pre class="sourceCode numberSource sas number-lines code-with-copy"><code class="sourceCode"><span id="cb14-1"><a href="#cb14-1"></a>/* 悪い例：80桁以降に重要な変数を配置 */</span>
<span id="cb14-2"><a href="#cb14-2"></a>                                                                              /*80桁*/</span>
<span id="cb14-3"><a href="#cb14-3"></a>data newdata;</span>
<span id="cb14-4"><a href="#cb14-4"></a>    set olddata (drop=name                                                   fname</span>
<span id="cb14-5"><a href="#cb14-5"></a>                     address city state);  /* 重要な変数が見えない */</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><strong>解説</strong>: 80桁以降に重要な変数名を配置しています。多くのエディタでは80桁以降が表示されないか、画面外に隠れるため、重要な処理内容が見えなくなります。</p>
</section>
<section id="会社ロゴ形式のコード" class="level3" data-number="1.4.5">
<h3 data-number="1.4.5" class="anchored" data-anchor-id="会社ロゴ形式のコード"><span class="header-section-number">1.4.5</span> 会社ロゴ形式のコード</h3>
<div class="sourceCode" id="cb15" data-eval="FALSE," data-code-overflow="wrap"><pre class="sourceCode numberSource sas number-lines code-with-copy"><code class="sourceCode"><span id="cb15-1"><a href="#cb15-1"></a>/* 悪い例：見た目重視のコード配置 */</span>
<span id="cb15-2"><a href="#cb15-2"></a>         data</span>
<span id="cb15-3"><a href="#cb15-3"></a>      sasclass.biomass;</span>
<span id="cb15-4"><a href="#cb15-4"></a>      infile cards missover;</span>
<span id="cb15-5"><a href="#cb15-5"></a>      input @1 STATION $</span>
<span id="cb15-6"><a href="#cb15-6"></a>      @12 DATE DATE7.</span>
<span id="cb15-7"><a href="#cb15-7"></a>      @20 BMPOLY</span>
<span id="cb15-8"><a href="#cb15-8"></a>   @25 BMCRUS @31 BMMOL</span>
<span id="cb15-9"><a href="#cb15-9"></a>  @36 BMOTHR @41 BMTOTL</span>
<span id="cb15-10"><a href="#cb15-10"></a>      ; format</span>
<span id="cb15-11"><a href="#cb15-11"></a>      date date7.</span>
<span id="cb15-12"><a href="#cb15-12"></a>      ;label BMCRUS=</span>
<span id="cb15-13"><a href="#cb15-13"></a>   'CRUSTACEAN BIOMASS'</span>
<span id="cb15-14"><a href="#cb15-14"></a>         BMMOL=</span>
<span id="cb15-15"><a href="#cb15-15"></a>   'MOLLUSC BIOMASS'</span>
<span id="cb15-16"><a href="#cb15-16"></a>      ;</span>
<span id="cb15-17"><a href="#cb15-17"></a>      run;</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><strong>解説</strong>: 機能性を完全に無視して、見た目の形（おそらく会社ロゴや図形）を優先してコードを配置しています。読みやすさが完全に犠牲になっています。</p>
</section>
</section>
<section id="コメントの悪用" class="level2" data-number="1.5">
<h2 data-number="1.5" class="anchored" data-anchor-id="コメントの悪用"><span class="header-section-number">1.5</span> 💬 コメントの悪用</h2>
<section id="実行可能コメント" class="level3" data-number="1.5.1">
<h3 data-number="1.5.1" class="anchored" data-anchor-id="実行可能コメント"><span class="header-section-number">1.5.1</span> 実行可能コメント</h3>
<div class="sourceCode" id="cb16" data-eval="FALSE," data-code-overflow="wrap"><pre class="sourceCode numberSource sas number-lines code-with-copy"><code class="sourceCode"><span id="cb16-1"><a href="#cb16-1"></a>/* 悪い例：コメント内に実行文を隠す */</span>
<span id="cb16-2"><a href="#cb16-2"></a>* The comments in this section do more ;</span>
<span id="cb16-3"><a href="#cb16-3"></a>* than it seems ;</span>
<span id="cb16-4"><a href="#cb16-4"></a>* ;</span>
<span id="cb16-5"><a href="#cb16-5"></a>* modify data to prep for; proc means ;</span>
<span id="cb16-6"><a href="#cb16-6"></a>* after adjusting the data using ;</span>
<span id="cb16-7"><a href="#cb16-7"></a>* the; var for weight ;</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><strong>解説</strong>: 一見コメントに見えますが、実際には<code>proc means; var for weight;</code>という実行可能なコードが隠されています。3行目の<code>* ;</code>でコメントが終了し、4-6行目が実際に実行されます。</p>
</section>
<section id="ネストできないコメントの悪用" class="level3" data-number="1.5.2">
<h3 data-number="1.5.2" class="anchored" data-anchor-id="ネストできないコメントの悪用"><span class="header-section-number">1.5.2</span> ネストできないコメントの悪用</h3>
<div class="sourceCode" id="cb17" data-eval="FALSE," data-code-overflow="wrap"><pre class="sourceCode numberSource sas number-lines code-with-copy"><code class="sourceCode"><span id="cb17-1"><a href="#cb17-1"></a>/* 悪い例：未完了コメントでコード全体を隠す */</span>
<span id="cb17-2"><a href="#cb17-2"></a>/* *****************</span>
<span id="cb17-3"><a href="#cb17-3"></a>* Apply the</span>
<span id="cb17-4"><a href="#cb17-4"></a>* ***very ***</span>
<span id="cb17-5"><a href="#cb17-5"></a>* important adjustment;</span>
<span id="cb17-6"><a href="#cb17-6"></a>data yearly;</span>
<span id="cb17-7"><a href="#cb17-7"></a>    set yearly;</span>
<span id="cb17-8"><a href="#cb17-8"></a>    income = income*adjust;</span>
<span id="cb17-9"><a href="#cb17-9"></a>run;</span>
<span id="cb17-10"><a href="#cb17-10"></a>/* Plot the adjusted income */</span>
<span id="cb17-11"><a href="#cb17-11"></a>proc gplot data=yearly......</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><strong>解説</strong>: 最初の<code>/*</code>コメントが閉じられていないため、その後のコード全体がコメント扱いになります。<code>/* Plot the adjusted income */</code>の<code>*/</code>で最初のコメントが閉じられ、それ以降のコードが実行されます。</p>
</section>
<section id="埋め込みコメントによる部分実行" class="level3" data-number="1.5.3">
<h3 data-number="1.5.3" class="anchored" data-anchor-id="埋め込みコメントによる部分実行"><span class="header-section-number">1.5.3</span> 埋め込みコメントによる部分実行</h3>
<div class="sourceCode" id="cb18" data-eval="FALSE," data-code-overflow="wrap"><pre class="sourceCode numberSource sas number-lines code-with-copy"><code class="sourceCode"><span id="cb18-1"><a href="#cb18-1"></a>/* 悪い例：コメント内の一部のみ実行 */</span>
<span id="cb18-2"><a href="#cb18-2"></a>/* *****************</span>
<span id="cb18-3"><a href="#cb18-3"></a>REMOVE FOR PRODUCTION</span>
<span id="cb18-4"><a href="#cb18-4"></a>proc print data=big obs=25;</span>
<span id="cb18-5"><a href="#cb18-5"></a>    title1 'Test print of BIG';</span>
<span id="cb18-6"><a href="#cb18-6"></a>    var company dept mgr /*clerk*/;</span>
<span id="cb18-7"><a href="#cb18-7"></a>data big;</span>
<span id="cb18-8"><a href="#cb18-8"></a>    set big;</span>
<span id="cb18-9"><a href="#cb18-9"></a>    if name='me' then salary=salary+5;</span>
<span id="cb18-10"><a href="#cb18-10"></a>*END OF REMOVED SECTION;</span>
<span id="cb18-11"><a href="#cb18-11"></a>****************** */</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><strong>解説</strong>: 全体がコメントで囲まれているように見えますが、<code>/*clerk*/</code>の部分で一時的にコメントが閉じ、その後のdataステップが実行されます。給与を不正に操作するコードが隠されて実行されてしまいます。</p>
</section>
</section>
<section id="命名規則の悪用" class="level2" data-number="1.6">
<h2 data-number="1.6" class="anchored" data-anchor-id="命名規則の悪用"><span class="header-section-number">1.6</span> 🔤 命名規則の悪用</h2>
<section id="混乱を招く命名" class="level3" data-number="1.6.1">
<h3 data-number="1.6.1" class="anchored" data-anchor-id="混乱を招く命名"><span class="header-section-number">1.6.1</span> 混乱を招く命名</h3>
<div class="sourceCode" id="cb19" data-eval="FALSE," data-code-overflow="wrap"><pre class="sourceCode numberSource sas number-lines code-with-copy"><code class="sourceCode"><span id="cb19-1"><a href="#cb19-1"></a>/* 悪い例：意味不明な変数名 */</span>
<span id="cb19-2"><a href="#cb19-2"></a>data analysis;</span>
<span id="cb19-3"><a href="#cb19-3"></a>    set patient_data;</span>
<span id="cb19-4"><a href="#cb19-4"></a>    /* デバッグ時は meaningful names を使い、後でCHANGEコマンドで変更 */</span>
<span id="cb19-5"><a href="#cb19-5"></a>    /* ===&gt; c 'age' 'qwrtxzqr' all */</span>
<span id="cb19-6"><a href="#cb19-6"></a>    QWRTXZQR = age;           /* 年齢なのに意味不明な名前 */</span>
<span id="cb19-7"><a href="#cb19-7"></a>    QWRTZXQR = weight;        /* 似たような名前で混乱 */</span>
<span id="cb19-8"><a href="#cb19-8"></a>    QWRZTXQR = height;        /* 微妙な違いで判別困難 */</span>
<span id="cb19-9"><a href="#cb19-9"></a>    HHHIIHIH = height;        /* HとIの区別が困難 */</span>
<span id="cb19-10"><a href="#cb19-10"></a>    WVWVWVVW = weight;        /* VとWの区別が困難 */</span>
<span id="cb19-11"><a href="#cb19-11"></a>    testnuml = test_result;   /* 1（数字）とl（小文字L）の混用 */</span>
<span id="cb19-12"><a href="#cb19-12"></a>    test0001 = test_id;       /* 0（ゼロ）とO（オー）の混用 */</span>
<span id="cb19-13"><a href="#cb19-13"></a>    QWRT2XQR = group;         /* ZとNの混用 */</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><strong>解説</strong>:</p>
<ul>
<li><p>母音を避けた無意味な文字列を使用</p></li>
<li><p>似たような文字の組み合わせで視覚的混乱を誘発</p></li>
<li><p>数字と文字の見た目が似ているものを混用（1とl、0とO、2とZ）</p></li>
<li><p>コメントで「デバッグ時には意味のある名前を使い、後で置換する」という悪質な手法を示唆</p></li>
</ul>
</section>
<section id="sasキーワードの変数名使用" class="level3" data-number="1.6.2">
<h3 data-number="1.6.2" class="anchored" data-anchor-id="sasキーワードの変数名使用"><span class="header-section-number">1.6.2</span> SASキーワードの変数名使用</h3>
<div class="sourceCode" id="cb20" data-eval="FALSE," data-code-overflow="wrap"><pre class="sourceCode numberSource sas number-lines code-with-copy"><code class="sourceCode"><span id="cb20-1"><a href="#cb20-1"></a>/* 悪い例：SASキーワードを変数名に使用 */</span>
<span id="cb20-2"><a href="#cb20-2"></a>DATA SET; </span>
<span id="cb20-3"><a href="#cb20-3"></a>SET DATA;</span>
<span id="cb20-4"><a href="#cb20-4"></a>DO = 5+ TO -15;  /* DO loopに見えるが変数代入 */</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><strong>解説</strong>: <code>DATA</code>、<code>SET</code>、<code>DO</code>、<code>TO</code>などのSASキーワードを変数名として使用しています。<code>DO = 5+ TO -15;</code>は一見DO loopに見えますが、実際は変数<code>DO</code>に<code>5 + TO - 15</code>を代入するステートメントです。</p>
</section>
<section id="誤解を招く命名" class="level3" data-number="1.6.3">
<h3 data-number="1.6.3" class="anchored" data-anchor-id="誤解を招く命名"><span class="header-section-number">1.6.3</span> 誤解を招く命名</h3>
<div class="sourceCode" id="cb21" data-eval="FALSE," data-code-overflow="wrap"><pre class="sourceCode numberSource sas number-lines code-with-copy"><code class="sourceCode"><span id="cb21-1"><a href="#cb21-1"></a>/* 悪い例：変数名と内容が一致しない */</span>
<span id="cb21-2"><a href="#cb21-2"></a>data patients;</span>
<span id="cb21-3"><a href="#cb21-3"></a>    set raw_data;</span>
<span id="cb21-4"><a href="#cb21-4"></a>    SEX = fish_count;        /* SEXという名前だが魚の数 */</span>
<span id="cb21-5"><a href="#cb21-5"></a>    WEIGHT = height_cm;      /* WEIGHTという名前だが身長 */</span>
<span id="cb21-6"><a href="#cb21-6"></a>    INCHES = height_cm;      /* INCHESだがセンチメートル */</span>
<span id="cb21-7"><a href="#cb21-7"></a>    </span>
<span id="cb21-8"><a href="#cb21-8"></a>    /* 出力先も混乱させる */</span>
<span id="cb21-9"><a href="#cb21-9"></a>    IF SEX = 'MALES' THEN OUTPUT FEMALES;</span>
<span id="cb21-10"><a href="#cb21-10"></a>    </span>
<span id="cb21-11"><a href="#cb21-11"></a>    /* ラベルでさらに混乱 */</span>
<span id="cb21-12"><a href="#cb21-12"></a>    LABEL sex = 'Sex of the Patient';  /* 実際は魚の数 */</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><strong>解説</strong>:</p>
<ul>
<li><p>変数名と実際の内容が完全に異なる（SEXに魚の数、WEIGHTに身長など）</p></li>
<li><p>OUTPUT文で条件と出力先が逆転（MALESの条件でFEMALESデータセットに出力）</p></li>
<li><p>LABELでさらに混乱を助長（魚の数に「患者の性別」というラベル）</p></li>
</ul>
</section>
<section id="一貫性のない命名" class="level3" data-number="1.6.4">
<h3 data-number="1.6.4" class="anchored" data-anchor-id="一貫性のない命名"><span class="header-section-number">1.6.4</span> 一貫性のない命名</h3>
<div class="sourceCode" id="cb22" data-eval="FALSE," data-code-overflow="wrap"><pre class="sourceCode numberSource sas number-lines code-with-copy"><code class="sourceCode"><span id="cb22-1"><a href="#cb22-1"></a>/* 悪い例：YES/NOの値が一貫しない */</span>
<span id="cb22-2"><a href="#cb22-2"></a>data flags;</span>
<span id="cb22-3"><a href="#cb22-3"></a>    set survey;</span>
<span id="cb22-4"><a href="#cb22-4"></a>    /* 通常: YES=0, NO=1 */</span>
<span id="cb22-5"><a href="#cb22-5"></a>    response1 = (answer='YES') * 0 + (answer='NO') * 1;</span>
<span id="cb22-6"><a href="#cb22-6"></a>    </span>
<span id="cb22-7"><a href="#cb22-7"></a>    /* どこかで例外: YES=1, NO=0 */</span>
<span id="cb22-8"><a href="#cb22-8"></a>    response2 = (answer='YES') * 1 + (answer='NO') * 0;</span>
<span id="cb22-9"><a href="#cb22-9"></a>    </span>
<span id="cb22-10"><a href="#cb22-10"></a>    /* さらに混乱: Y=NOの意味、N=YESの意味 */</span>
<span id="cb22-11"><a href="#cb22-11"></a>    if answer='YES' then code='N';</span>
<span id="cb22-12"><a href="#cb22-12"></a>    else if answer='NO' then code='Y';</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><strong>解説</strong>:</p>
<ul>
<li><p>同じプログラム内でYES/NOのコーディングが一貫していない</p></li>
<li><p>通常の論理（YES=1, NO=0）とは逆の設定</p></li>
<li><p>最後は完全に逆転（YESなのにN、NOなのにY）</p></li>
</ul>
</section>
</section>
<section id="データステップの境界をぼかす技法" class="level2" data-number="1.7">
<h2 data-number="1.7" class="anchored" data-anchor-id="データステップの境界をぼかす技法"><span class="header-section-number">1.7</span> 🌀 データステップの境界をぼかす技法</h2>
<section id="コメントによる境界隠し" class="level3" data-number="1.7.1">
<h3 data-number="1.7.1" class="anchored" data-anchor-id="コメントによる境界隠し"><span class="header-section-number">1.7.1</span> コメントによる境界隠し</h3>
<div class="sourceCode" id="cb23" data-eval="FALSE," data-code-overflow="wrap"><pre class="sourceCode numberSource sas number-lines code-with-copy"><code class="sourceCode"><span id="cb23-1"><a href="#cb23-1"></a>/* 悪い例：セミコロンなしコメントで次ステップを隠す */</span>
<span id="cb23-2"><a href="#cb23-2"></a>data new; </span>
<span id="cb23-3"><a href="#cb23-3"></a>    set old;</span>
<span id="cb23-4"><a href="#cb23-4"></a>    x = 5 * y;</span>
<span id="cb23-5"><a href="#cb23-5"></a>    /* この行で次のステップが始まっている</span>
<span id="cb23-6"><a href="#cb23-6"></a>    data second; </span>
<span id="cb23-7"><a href="#cb23-7"></a>    set gudstuff;</span>
<span id="cb23-8"><a href="#cb23-8"></a>    x = zzstuff;</span>
<span id="cb23-9"><a href="#cb23-9"></a>/* 結果：NEWにはzsstuffの値が入る */</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><strong>解説</strong>: 4行目のコメントにセミコロンがないため、5-7行目がコメント扱いになりません。実際には1つのDATAステップで2つのSETステートメントが実行され、最後の<code>x = zzstuff;</code>の値が最終的に変数xに残ります。</p>
</section>
<section id="コロンによる巧妙な隠蔽" class="level3" data-number="1.7.2">
<h3 data-number="1.7.2" class="anchored" data-anchor-id="コロンによる巧妙な隠蔽"><span class="header-section-number">1.7.2</span> コロンによる巧妙な隠蔽</h3>
<div class="sourceCode" id="cb24" data-eval="FALSE," data-code-overflow="wrap"><pre class="sourceCode numberSource sas number-lines code-with-copy"><code class="sourceCode"><span id="cb24-1"><a href="#cb24-1"></a>/* 悪い例：セミコロンの代わりにコロンを使用 */</span>
<span id="cb24-2"><a href="#cb24-2"></a>data new; </span>
<span id="cb24-3"><a href="#cb24-3"></a>    set old;</span>
<span id="cb24-4"><a href="#cb24-4"></a>    x = 5 * y;</span>
<span id="cb24-5"><a href="#cb24-5"></a>    /* この行で次のステップが始まっている:</span>
<span id="cb24-6"><a href="#cb24-6"></a>    data second; </span>
<span id="cb24-7"><a href="#cb24-7"></a>    set gudstuff;</span>
<span id="cb24-8"><a href="#cb24-8"></a>    x = zzstuff;</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><strong>解説</strong>: コメント行の最後がセミコロンではなくコロンになっています。SASではコロンはコメントの終了記号として認識されないため、次のdataステップが隠されて実行されます。</p>
</section>
<section id="不完全な引用符による隠蔽" class="level3" data-number="1.7.3">
<h3 data-number="1.7.3" class="anchored" data-anchor-id="不完全な引用符による隠蔽"><span class="header-section-number">1.7.3</span> 不完全な引用符による隠蔽</h3>
<div class="sourceCode" id="cb25" data-eval="FALSE," data-code-overflow="wrap"><pre class="sourceCode numberSource sas number-lines code-with-copy"><code class="sourceCode"><span id="cb25-1"><a href="#cb25-1"></a>/* 悪い例：不完全な引用符で後続コードを隠す */</span>
<span id="cb25-2"><a href="#cb25-2"></a>data new;</span>
<span id="cb25-3"><a href="#cb25-3"></a>    y = 5;</span>
<span id="cb25-4"><a href="#cb25-4"></a>    frankwt = 0;</span>
<span id="cb25-5"><a href="#cb25-5"></a>    x = 5 * y;</span>
<span id="cb25-6"><a href="#cb25-6"></a>    length name $6;</span>
<span id="cb25-7"><a href="#cb25-7"></a>    name = 'weight;</span>
<span id="cb25-8"><a href="#cb25-8"></a>    data second; set gudstuff;  /* この行が隠されている */</span>
<span id="cb25-9"><a href="#cb25-9"></a>    *for weight use Franks';</span>
<span id="cb25-10"><a href="#cb25-10"></a>    x = frankwt;</span>
<span id="cb25-11"><a href="#cb25-11"></a>proc print; run;</span>
<span id="cb25-12"><a href="#cb25-12"></a>/* 結果：xは常に0（25ではない） */</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><strong>解説</strong>:</p>
<ul>
<li><p>6行目で開始された文字列リテラル<code>'weight;</code>が閉じられていない</p></li>
<li><p>そのため7-8行目が文字列の一部として扱われ、実行されない</p></li>
<li><p>9行目の<code>'</code>で文字列が閉じられ、その後のコードが実行される</p></li>
<li><p>結果として<code>x = frankwt;</code>（0）が実行され、期待された<code>x = 5 * y;</code>（25）は無効になる</p></li>
</ul>
</section>
</section>
<section id="さらに極端な技法上級者向け悪魔術" class="level2" data-number="1.8">
<h2 data-number="1.8" class="anchored" data-anchor-id="さらに極端な技法上級者向け悪魔術"><span class="header-section-number">1.8</span> 🔥 さらに極端な技法（上級者向け悪魔術）</h2>
<section id="ソースコードの隠蔽削除" class="level3" data-number="1.8.1">
<h3 data-number="1.8.1" class="anchored" data-anchor-id="ソースコードの隠蔽削除"><span class="header-section-number">1.8.1</span> ソースコードの隠蔽・削除</h3>
<div class="sourceCode" id="cb26" data-eval="FALSE," data-code-overflow="wrap"><pre class="sourceCode numberSource sas number-lines code-with-copy"><code class="sourceCode"><span id="cb26-1"><a href="#cb26-1"></a>/* 悪い例：コンパイル後にソースを削除・改名 */</span>
<span id="cb26-2"><a href="#cb26-2"></a>/* SCL source code for SAS/AF applications */</span>
<span id="cb26-3"><a href="#cb26-3"></a>/* Compiled DATA steps */</span>
<span id="cb26-4"><a href="#cb26-4"></a>/* Compiled stored macros */</span>
<span id="cb26-5"><a href="#cb26-5"></a>/* DATA step views */</span>
<span id="cb26-6"><a href="#cb26-6"></a>/* SQL views（DESCRIBE optionで復元可能だが...） */</span>
<span id="cb26-7"><a href="#cb26-7"></a></span>
<span id="cb26-8"><a href="#cb26-8"></a>/* エディタの文字色を背景色と同じにして隠す */</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><strong>解説</strong>:</p>
<ul>
<li><p>コンパイル済みのSAS/AFアプリケーション、ストアドマクロなどの元ソースコードを削除</p></li>
<li><p>DATA step viewやSQL viewのソースも隠蔽</p></li>
<li><p>エディタで文字色を背景色と同じにして視覚的に見えなくする これらにより、動作するプログラムがあっても、どのように動作しているかが分からなくなります。</p></li>
</ul>
</section>
<section id="autoexec.sasとconfig.sasの悪用" class="level3" data-number="1.8.2">
<h3 data-number="1.8.2" class="anchored" data-anchor-id="autoexec.sasとconfig.sasの悪用"><span class="header-section-number">1.8.2</span> AUTOEXEC.SASとCONFIG.SASの悪用</h3>
<div class="sourceCode" id="cb27" data-eval="FALSE," data-code-overflow="wrap"><pre class="sourceCode numberSource sas number-lines code-with-copy"><code class="sourceCode"><span id="cb27-1"><a href="#cb27-1"></a>/* 悪い例：AUTOEXEC.SASでセッション終了 */</span>
<span id="cb27-2"><a href="#cb27-2"></a>ENDSAS;</span>
<span id="cb27-3"><a href="#cb27-3"></a>/* または */</span>
<span id="cb27-4"><a href="#cb27-4"></a>ABORT;</span>
<span id="cb27-5"><a href="#cb27-5"></a>/* または */</span>
<span id="cb27-6"><a href="#cb27-6"></a>%MACRO DUMMY;  /* %MENDまでのすべてのコードを無効化 */</span>
<span id="cb27-7"><a href="#cb27-7"></a></span>
<span id="cb27-8"><a href="#cb27-8"></a>/* 悪い例：CONFIG.SASで隠れたERRORABEND設定 */</span>
<span id="cb27-9"><a href="#cb27-9"></a>-ERRORABEND</span>
<span id="cb27-10"><a href="#cb27-10"></a></span>
<span id="cb27-11"><a href="#cb27-11"></a>/* 悪い例：AUTOEXEC.SASの最後に未完了コメント */</span>
<span id="cb27-12"><a href="#cb27-12"></a>/* 以降のすべてのコードがコメント扱いに */</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><strong>解説</strong>:</p>
<ul>
<li><p><code>ENDSAS</code>や<code>ABORT</code>をAUTOEXEC.SASに入れると、ユーザーのプログラムが実行される前にセッションが終了</p></li>
<li><p><code>%MACRO DUMMY;</code>を入れると、<code>%MEND</code>が現れるまでのすべてのコードがマクロ定義として扱われ実行されない</p></li>
<li><p>CONFIG.SASでの<code>ERRORABEND</code>設定は非常に見つけにくい</p></li>
<li><p>AUTOEXEC.SASの最後に<code>/*</code>を入れると、以降のすべての投入コードがコメント扱いになる</p></li>
</ul>
</section>
<section id="危険なデータステップ技法" class="level3" data-number="1.8.3">
<h3 data-number="1.8.3" class="anchored" data-anchor-id="危険なデータステップ技法"><span class="header-section-number">1.8.3</span> 危険なデータステップ技法</h3>
<div class="sourceCode" id="cb28" data-eval="FALSE," data-code-overflow="wrap"><pre class="sourceCode numberSource sas number-lines code-with-copy"><code class="sourceCode"><span id="cb28-1"><a href="#cb28-1"></a>/* 悪い例：BYステートメント変数の途中変更 */</span>
<span id="cb28-2"><a href="#cb28-2"></a>data merged;</span>
<span id="cb28-3"><a href="#cb28-3"></a>    merge data1 data2;</span>
<span id="cb28-4"><a href="#cb28-4"></a>    by id;</span>
<span id="cb28-5"><a href="#cb28-5"></a>    id = id + 1;  /* BYステートメント変数を変更 */</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><strong>解説</strong>: MERGEステートメントのBY変数<code>id</code>を、マージ処理の途中で変更しています。これにより予期しないマージ結果が生成され、データの整合性が失われます。</p>
</section>
<section id="pointnobsオプションの落とし穴" class="level3" data-number="1.8.4">
<h3 data-number="1.8.4" class="anchored" data-anchor-id="pointnobsオプションの落とし穴"><span class="header-section-number">1.8.4</span> POINT/NOBSオプションの落とし穴</h3>
<div class="sourceCode" id="cb29" data-eval="FALSE," data-code-overflow="wrap"><pre class="sourceCode numberSource sas number-lines code-with-copy"><code class="sourceCode"><span id="cb29-1"><a href="#cb29-1"></a>/* 悪い例：削除された観測値との相互作用 */</span>
<span id="cb29-2"><a href="#cb29-2"></a>data a;</span>
<span id="cb29-3"><a href="#cb29-3"></a>    do i = 1 to 5;</span>
<span id="cb29-4"><a href="#cb29-4"></a>        output;</span>
<span id="cb29-5"><a href="#cb29-5"></a>    end;</span>
<span id="cb29-6"><a href="#cb29-6"></a>run;</span>
<span id="cb29-7"><a href="#cb29-7"></a>/* FSEDITでi=2の観測値を削除 */</span>
<span id="cb29-8"><a href="#cb29-8"></a></span>
<span id="cb29-9"><a href="#cb29-9"></a>data b;</span>
<span id="cb29-10"><a href="#cb29-10"></a>    do point=1 to nobs;</span>
<span id="cb29-11"><a href="#cb29-11"></a>        set a point=point nobs=nobs;</span>
<span id="cb29-12"><a href="#cb29-12"></a>        output;</span>
<span id="cb29-13"><a href="#cb29-13"></a>    end;</span>
<span id="cb29-14"><a href="#cb29-14"></a>    stop;</span>
<span id="cb29-15"><a href="#cb29-15"></a>run;</span>
<span id="cb29-16"><a href="#cb29-16"></a>/* 結果：削除された観測値が読まれ、iの値が不正になる */</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><strong>解説</strong>:</p>
<ul>
<li><p>データセットAから観測値2（i=2）を削除</p></li>
<li><p>POINT/NOBSオプションで順次読み取ると、削除された位置でも読み取りが行われる</p></li>
<li><p>削除された観測値を読み取ると、変数iには予期しない値（この場合は1）が入る</p></li>
<li><p>結果として観測値2の位置でi=1が読まれ、データの整合性が失われる</p></li>
</ul>
</section>
<section id="マクロクォート関数の悪用" class="level3" data-number="1.8.5">
<h3 data-number="1.8.5" class="anchored" data-anchor-id="マクロクォート関数の悪用"><span class="header-section-number">1.8.5</span> マクロクォート関数の悪用</h3>
<div class="sourceCode" id="cb30" data-eval="FALSE," data-code-overflow="wrap"><pre class="sourceCode numberSource sas number-lines code-with-copy"><code class="sourceCode"><span id="cb30-1"><a href="#cb30-1"></a>/* 悪い例：マクロ変数の解決を阻害 */</span>
<span id="cb30-2"><a href="#cb30-2"></a>%macro doit(city);</span>
<span id="cb30-3"><a href="#cb30-3"></a>    %put &amp;city;</span>
<span id="cb30-4"><a href="#cb30-4"></a>    %let city=%nrstr(&amp;city);  /* 文字列として固定 */</span>
<span id="cb30-5"><a href="#cb30-5"></a>    %put &amp;city;</span>
<span id="cb30-6"><a href="#cb30-6"></a>    %if &amp;city = LA %then</span>
<span id="cb30-7"><a href="#cb30-7"></a>        %put CITY is LOS ANGELES;</span>
<span id="cb30-8"><a href="#cb30-8"></a>    %else </span>
<span id="cb30-9"><a href="#cb30-9"></a>        %put city is not LA;  /* 常にこちらが実行される */</span>
<span id="cb30-10"><a href="#cb30-10"></a>%mend doit;</span>
<span id="cb30-11"><a href="#cb30-11"></a></span>
<span id="cb30-12"><a href="#cb30-12"></a>%doit(LA)</span>
<span id="cb30-13"><a href="#cb30-13"></a>/* 出力: LA, &amp;city, city is not LA */</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><strong>解説</strong>:</p>
<ul>
<li><p><code>%nrstr(&amp;city)</code>により、マクロ変数<code>&amp;city</code>が文字列リテラル「&amp;city」として固定される</p></li>
<li><p>以降の比較<code>&amp;city = LA</code>では、「&amp;city」と「LA」が比較されるため、常にfalseになる</p></li>
<li><p>引数として「LA」を渡しても、条件判定では常に「not LA」の結果になる</p></li>
</ul>
</section>
<section id="特殊システムオプションの悪用" class="level3" data-number="1.8.6">
<h3 data-number="1.8.6" class="anchored" data-anchor-id="特殊システムオプションの悪用"><span class="header-section-number">1.8.6</span> 特殊システムオプションの悪用</h3>
<div class="sourceCode" id="cb31" data-eval="FALSE," data-code-overflow="wrap"><pre class="sourceCode numberSource sas number-lines code-with-copy"><code class="sourceCode"><span id="cb31-1"><a href="#cb31-1"></a>/* 悪い例：エラーメッセージ抑制 */</span>
<span id="cb31-2"><a href="#cb31-2"></a>options DKRICOND=NOWARN;  /* DROP/KEEP/RENAME文のエラーを隠す */</span>
<span id="cb31-3"><a href="#cb31-3"></a></span>
<span id="cb31-4"><a href="#cb31-4"></a>/* 悪い例：データセット置き換え防止 */</span>
<span id="cb31-5"><a href="#cb31-5"></a>options NOREPLACE;  /* 永続データセットの置き換えを阻止 */</span>
<span id="cb31-6"><a href="#cb31-6"></a></span>
<span id="cb31-7"><a href="#cb31-7"></a>/* 悪い例：WORK領域のクリーンアップ抑制 */</span>
<span id="cb31-8"><a href="#cb31-8"></a>options NOWORKINIT NOWORKTERM;  /* セッション終了後もファイル残存 */</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><strong>解説</strong>:</p>
<ul>
<li><p><code>DKRICOND=NOWARN</code>: DROP/KEEP/RENAMEステートメントで存在しない変数を指定してもエラーが出ない</p></li>
<li><p><code>NOREPLACE</code>: 既存の永続データセットを上書きしようとするとエラーになる（一見良いが、予期しない場所で設定されると混乱）</p></li>
<li><p><code>NOWORKINIT/NOWORKTERM</code>: SASセッション終了後もWORKライブラリのファイルが残り、ディスク容量やセキュリティの問題を引き起こす</p></li>
</ul>
</section>
</section>
<section id="正しいプログラミング実践推奨事項" class="level2" data-number="1.9">
<h2 data-number="1.9" class="anchored" data-anchor-id="正しいプログラミング実践推奨事項"><span class="header-section-number">1.9</span> ✅ 正しいプログラミング実践（推奨事項）</h2>
<section id="良いコードの原則" class="level3" data-number="1.9.1">
<h3 data-number="1.9.1" class="anchored" data-anchor-id="良いコードの原則"><span class="header-section-number">1.9.1</span> 良いコードの原則</h3>
<div class="sourceCode" id="cb32" data-eval="FALSE," data-code-overflow="wrap"><pre class="sourceCode numberSource sas number-lines code-with-copy"><code class="sourceCode"><span id="cb32-1"><a href="#cb32-1"></a>/* 良い例：読みやすく保守しやすいコード */</span>
<span id="cb32-2"><a href="#cb32-2"></a>options MSGLEVEL=I SOURCE FMTERR DSNFERR NOREPLACE;</span>
<span id="cb32-3"><a href="#cb32-3"></a></span>
<span id="cb32-4"><a href="#cb32-4"></a>/* Step 1: Demographics data preparation */</span>
<span id="cb32-5"><a href="#cb32-5"></a>data adam.adsl;</span>
<span id="cb32-6"><a href="#cb32-6"></a>    set raw.demographics;</span>
<span id="cb32-7"><a href="#cb32-7"></a>    </span>
<span id="cb32-8"><a href="#cb32-8"></a>    /* Treatment group coding */</span>
<span id="cb32-9"><a href="#cb32-9"></a>    if trt01a = 'Placebo' then trt01pn = 1;</span>
<span id="cb32-10"><a href="#cb32-10"></a>    else if trt01a = 'Active 10mg' then trt01pn = 2;</span>
<span id="cb32-11"><a href="#cb32-11"></a>    else if trt01a = 'Active 20mg' then trt01pn = 3;</span>
<span id="cb32-12"><a href="#cb32-12"></a>    </span>
<span id="cb32-13"><a href="#cb32-13"></a>    /* Age group classification */</span>
<span id="cb32-14"><a href="#cb32-14"></a>    if age &lt; 65 then agegroup = 'Under 65';</span>
<span id="cb32-15"><a href="#cb32-15"></a>    else agegroup = '65 and Over';</span>
<span id="cb32-16"><a href="#cb32-16"></a>    </span>
<span id="cb32-17"><a href="#cb32-17"></a>    /* Safety population flag */</span>
<span id="cb32-18"><a href="#cb32-18"></a>    if cmstdt ne . then saffl = 'Y';</span>
<span id="cb32-19"><a href="#cb32-19"></a>    else saffl = 'N';</span>
<span id="cb32-20"><a href="#cb32-20"></a>    </span>
<span id="cb32-21"><a href="#cb32-21"></a>    /* Variable labels */</span>
<span id="cb32-22"><a href="#cb32-22"></a>    label trt01pn = 'Treatment Group (Numeric)'</span>
<span id="cb32-23"><a href="#cb32-23"></a>          agegroup = 'Age Group'</span>
<span id="cb32-24"><a href="#cb32-24"></a>          saffl = 'Safety Population Flag';</span>
<span id="cb32-25"><a href="#cb32-25"></a>run;</span>
<span id="cb32-26"><a href="#cb32-26"></a></span>
<span id="cb32-27"><a href="#cb32-27"></a>/* Step 2: Data validation */</span>
<span id="cb32-28"><a href="#cb32-28"></a>proc freq data=adam.adsl;</span>
<span id="cb32-29"><a href="#cb32-29"></a>    tables trt01pn*trt01a / missing;</span>
<span id="cb32-30"><a href="#cb32-30"></a>    title1 'Treatment Group Verification';</span>
<span id="cb32-31"><a href="#cb32-31"></a>run;</span>
<span id="cb32-32"><a href="#cb32-32"></a></span>
<span id="cb32-33"><a href="#cb32-33"></a>proc means data=adam.adsl n nmiss min max;</span>
<span id="cb32-34"><a href="#cb32-34"></a>    var age;</span>
<span id="cb32-35"><a href="#cb32-35"></a>    title1 'Age Distribution Check';</span>
<span id="cb32-36"><a href="#cb32-36"></a>run;</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><strong>解説</strong>:</p>
<ul>
<li><p>明確なコメントで各ステップの目的を説明</p></li>
<li><p>意味のある変数名とラベルを使用</p></li>
<li><p>処理を論理的に分離（データ準備→検証）</p></li>
<li><p>品質管理オプションを適切に設定</p></li>
<li><p>一貫したインデントとフォーマット</p></li>
</ul>
</section>
<section id="臨床試験での品質管理" class="level3" data-number="1.9.2">
<h3 data-number="1.9.2" class="anchored" data-anchor-id="臨床試験での品質管理"><span class="header-section-number">1.9.2</span> 臨床試験での品質管理</h3>
<div class="sourceCode" id="cb33" data-eval="FALSE," data-code-overflow="wrap"><pre class="sourceCode numberSource sas number-lines code-with-copy"><code class="sourceCode"><span id="cb33-1"><a href="#cb33-1"></a>/* Step 3: Efficacy endpoint derivation */</span>
<span id="cb33-2"><a href="#cb33-2"></a>data adam.adeff;</span>
<span id="cb33-3"><a href="#cb33-3"></a>    set adam.adsl(keep=usubjid trt01pn saffl);</span>
<span id="cb33-4"><a href="#cb33-4"></a>    </span>
<span id="cb33-5"><a href="#cb33-5"></a>    /* Merge with vital signs */</span>
<span id="cb33-6"><a href="#cb33-6"></a>    merge adam.adsl(in=demo)</span>
<span id="cb33-7"><a href="#cb33-7"></a>          raw.vitals(in=vital </span>
<span id="cb33-8"><a href="#cb33-8"></a>                     keep=usubjid visitnum aval param);</span>
<span id="cb33-9"><a href="#cb33-9"></a>    by usubjid;</span>
<span id="cb33-10"><a href="#cb33-10"></a>    </span>
<span id="cb33-11"><a href="#cb33-11"></a>    /* Only include subjects with baseline and post-baseline values */</span>
<span id="cb33-12"><a href="#cb33-12"></a>    if demo and vital;</span>
<span id="cb33-13"><a href="#cb33-13"></a>    </span>
<span id="cb33-14"><a href="#cb33-14"></a>    /* Derive change from baseline */</span>
<span id="cb33-15"><a href="#cb33-15"></a>    retain baseline;</span>
<span id="cb33-16"><a href="#cb33-16"></a>    if visitnum = 1 then baseline = aval;</span>
<span id="cb33-17"><a href="#cb33-17"></a>    else if visitnum &gt; 1 and baseline ne . then do;</span>
<span id="cb33-18"><a href="#cb33-18"></a>        chg = aval - baseline;</span>
<span id="cb33-19"><a href="#cb33-19"></a>        pchg = (chg / baseline) * 100;</span>
<span id="cb33-20"><a href="#cb33-20"></a>    end;</span>
<span id="cb33-21"><a href="#cb33-21"></a>    </span>
<span id="cb33-22"><a href="#cb33-22"></a>    /* Quality checks */</span>
<span id="cb33-23"><a href="#cb33-23"></a>    if baseline = . then put "WARNING: Missing baseline for " usubjid=;</span>
<span id="cb33-24"><a href="#cb33-24"></a>    if aval = . and visitnum &gt; 1 then put "WARNING: Missing post-baseline value for " usubjid= visitnum=;</span>
<span id="cb33-25"><a href="#cb33-25"></a>    </span>
<span id="cb33-26"><a href="#cb33-26"></a>    label chg = 'Change from Baseline'</span>
<span id="cb33-27"><a href="#cb33-27"></a>          pchg = 'Percent Change from Baseline'</span>
<span id="cb33-28"><a href="#cb33-28"></a>          baseline = 'Baseline Value';</span>
<span id="cb33-29"><a href="#cb33-29"></a>run;</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><strong>解説</strong>:</p>
<ul>
<li><p>データセットの結合条件を明確に指定（<code>in=demo and vital</code>）</p></li>
<li><p>ベースライン値の適切な保持と計算</p></li>
<li><p>品質チェックを組み込み、問題があればログに出力</p></li>
<li><p>計算ロジックを段階的に記述し、理解しやすくする</p></li>
<li><p>派生変数には適切なラベルを付与</p></li>
</ul>
</section>
</section>
<section id="心理的トリックと認知バイアスの悪用" class="level2" data-number="1.10">
<h2 data-number="1.10" class="anchored" data-anchor-id="心理的トリックと認知バイアスの悪用"><span class="header-section-number">1.10</span> 🧠 心理的トリックと認知バイアスの悪用</h2>
<section id="先入観を利用した混乱" class="level3" data-number="1.10.1">
<h3 data-number="1.10.1" class="anchored" data-anchor-id="先入観を利用した混乱"><span class="header-section-number">1.10.1</span> 先入観を利用した混乱</h3>
<div class="sourceCode" id="cb34" data-eval="FALSE," data-code-overflow="wrap"><pre class="sourceCode numberSource sas number-lines code-with-copy"><code class="sourceCode"><span id="cb34-1"><a href="#cb34-1"></a>/* 悪い例：一般的な変数名で全く違う内容を格納 */</span>
<span id="cb34-2"><a href="#cb34-2"></a>data demographics;</span>
<span id="cb34-3"><a href="#cb34-3"></a>    set patient_roster;</span>
<span id="cb34-4"><a href="#cb34-4"></a>    </span>
<span id="cb34-5"><a href="#cb34-5"></a>    /* 通常なら患者情報だが... */</span>
<span id="cb34-6"><a href="#cb34-6"></a>    age = protocol_version;      /* 年齢ではなくプロトコル番号 */</span>
<span id="cb34-7"><a href="#cb34-7"></a>    sex = randomization_seed;    /* 性別ではなく乱数シード */</span>
<span id="cb34-8"><a href="#cb34-8"></a>    height = study_duration;     /* 身長ではなく研究期間 */</span>
<span id="cb34-9"><a href="#cb34-9"></a>    weight = site_number;        /* 体重ではなく施設番号 */</span>
<span id="cb34-10"><a href="#cb34-10"></a>    </span>
<span id="cb34-11"><a href="#cb34-11"></a>    /* ラベルで更なる混乱を誘発 */</span>
<span id="cb34-12"><a href="#cb34-12"></a>    label age = 'Patient Age (Years)'</span>
<span id="cb34-13"><a href="#cb34-13"></a>          sex = 'Patient Gender'</span>
<span id="cb34-14"><a href="#cb34-14"></a>          height = 'Height (cm)'</span>
<span id="cb34-15"><a href="#cb34-15"></a>          weight = 'Weight (kg)';</span>
<span id="cb34-16"><a href="#cb34-16"></a>run;</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><strong>解説</strong>: プログラマーの先入観を悪用した極めて悪質な手法。変数名から期待される内容と実際の内容が完全に異なり、さらにラベルでも嘘の情報を提供しています。これにより重大な解析エラーを引き起こす可能性があります。</p>
</section>
<section id="視覚的類似性を利用した混乱" class="level3" data-number="1.10.2">
<h3 data-number="1.10.2" class="anchored" data-anchor-id="視覚的類似性を利用した混乱"><span class="header-section-number">1.10.2</span> 視覚的類似性を利用した混乱</h3>
<div class="sourceCode" id="cb35" data-eval="FALSE," data-code-overflow="wrap"><pre class="sourceCode numberSource sas number-lines code-with-copy"><code class="sourceCode"><span id="cb35-1"><a href="#cb35-1"></a>/* 悪い例：見た目が似ている文字・数字の混用 */</span>
<span id="cb35-2"><a href="#cb35-2"></a>data confusion;</span>
<span id="cb35-3"><a href="#cb35-3"></a>    /* 数字の1と小文字のl */</span>
<span id="cb35-4"><a href="#cb35-4"></a>    testnum1 = score_1;</span>
<span id="cb35-5"><a href="#cb35-5"></a>    testnuml = score_l;  /* 実際は小文字のL */</span>
<span id="cb35-6"><a href="#cb35-6"></a>    </span>
<span id="cb35-7"><a href="#cb35-7"></a>    /* 数字の0と大文字のO */</span>
<span id="cb35-8"><a href="#cb35-8"></a>    patient0 = id_zero;</span>
<span id="cb35-9"><a href="#cb35-9"></a>    patientO = id_oh;    /* 実際は大文字のO */</span>
<span id="cb35-10"><a href="#cb35-10"></a>    </span>
<span id="cb35-11"><a href="#cb35-11"></a>    /* 数字の2とアルファベットのZ */</span>
<span id="cb35-12"><a href="#cb35-12"></a>    group2 = treatment_2;</span>
<span id="cb35-13"><a href="#cb35-13"></a>    groupZ = treatment_z; /* 実際はZ */</span>
<span id="cb35-14"><a href="#cb35-14"></a>    </span>
<span id="cb35-15"><a href="#cb35-15"></a>    /* IとlとlIの組み合わせ */</span>
<span id="cb35-16"><a href="#cb35-16"></a>    IlllIlIl = result_a;  /* 何がIで何がlか判別不可能 */</span>
<span id="cb35-17"><a href="#cb35-17"></a>    lIlIlIll = result_b;</span>
<span id="cb35-18"><a href="#cb35-18"></a>run;</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><strong>解説</strong>: フォントによっては区別が困難な文字を意図的に混用しています。特にプログラミング用でないフォントでは、これらの違いを見分けることは非常に困難になります。</p>
</section>
</section>
<section id="プロシージャの悪用" class="level2" data-number="1.11">
<h2 data-number="1.11" class="anchored" data-anchor-id="プロシージャの悪用"><span class="header-section-number">1.11</span> 🔄 プロシージャの悪用</h2>
<section id="proc-sqlの危険な使用法" class="level3" data-number="1.11.1">
<h3 data-number="1.11.1" class="anchored" data-anchor-id="proc-sqlの危険な使用法"><span class="header-section-number">1.11.1</span> PROC SQLの危険な使用法</h3>
<div class="sourceCode" id="cb36" data-eval="FALSE," data-code-overflow="wrap"><pre class="sourceCode numberSource sas number-lines code-with-copy"><code class="sourceCode"><span id="cb36-1"><a href="#cb36-1"></a>/* 悪い例：副作用のあるSQL */</span>
<span id="cb36-2"><a href="#cb36-2"></a>proc sql;</span>
<span id="cb36-3"><a href="#cb36-3"></a>    /* 一見単純な選択に見えるが... */</span>
<span id="cb36-4"><a href="#cb36-4"></a>    create table summary as</span>
<span id="cb36-5"><a href="#cb36-5"></a>    select *,</span>
<span id="cb36-6"><a href="#cb36-6"></a>           (select count(*) from work.temp_calc </span>
<span id="cb36-7"><a href="#cb36-7"></a>            where temp_calc.id = main.id) as calc_count</span>
<span id="cb36-8"><a href="#cb36-8"></a>    from main_data as main;</span>
<span id="cb36-9"><a href="#cb36-9"></a>    </span>
<span id="cb36-10"><a href="#cb36-10"></a>    /* work.temp_calcは実際には存在せず、</span>
<span id="cb36-11"><a href="#cb36-11"></a>       このクエリ実行中に副作用で作成される隠しプロセスがある */</span>
<span id="cb36-12"><a href="#cb36-12"></a>quit;</span>
<span id="cb36-13"><a href="#cb36-13"></a></span>
<span id="cb36-14"><a href="#cb36-14"></a>/* 隠された前処理（別の場所に配置） */</span>
<span id="cb36-15"><a href="#cb36-15"></a>data work.temp_calc / view=work.temp_calc;</span>
<span id="cb36-16"><a href="#cb36-16"></a>    set main_data;</span>
<span id="cb36-17"><a href="#cb36-17"></a>    /* 複雑な計算でmain_dataを変更 */</span>
<span id="cb36-18"><a href="#cb36-18"></a>    call execute('data main_data; modify main_data; id = id + 1000; run;');</span>
<span id="cb36-19"><a href="#cb36-19"></a>run;</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><strong>解説</strong>:</p>
<ul>
<li><p>一見単純なSELECTクエリに見えるが、サブクエリが隠された副作用を持つ</p></li>
<li><p>VIEWを使って実行時に元データを変更する隠れた処理を組み込む</p></li>
<li><p><code>CALL EXECUTE</code>により、クエリ実行中に予期しないデータ変更が発生</p></li>
</ul>
</section>
<section id="proc-sortの落とし穴" class="level3" data-number="1.11.2">
<h3 data-number="1.11.2" class="anchored" data-anchor-id="proc-sortの落とし穴"><span class="header-section-number">1.11.2</span> PROC SORTの落とし穴</h3>
<div class="sourceCode" id="cb37" data-eval="FALSE," data-code-overflow="wrap"><pre class="sourceCode numberSource sas number-lines code-with-copy"><code class="sourceCode"><span id="cb37-1"><a href="#cb37-1"></a>/* 悪い例：NODUPKEY vs NODUPLICATESの混乱 */</span>
<span id="cb37-2"><a href="#cb37-2"></a>/* 同じファイル名で異なる結果を生成 */</span>
<span id="cb37-3"><a href="#cb37-3"></a>proc sort data=patients out=clean_data NODUPKEY;</span>
<span id="cb37-4"><a href="#cb37-4"></a>    by patient_id visit_date;</span>
<span id="cb37-5"><a href="#cb37-5"></a>run;</span>
<span id="cb37-6"><a href="#cb37-6"></a>/* patient_idとvisit_dateの組み合わせで重複削除 */</span>
<span id="cb37-7"><a href="#cb37-7"></a></span>
<span id="cb37-8"><a href="#cb37-8"></a>/* どこか別の場所で... */</span>
<span id="cb37-9"><a href="#cb37-9"></a>proc sort data=patients out=clean_data NODUPLICATES;</span>
<span id="cb37-10"><a href="#cb37-10"></a>    by patient_id visit_date;</span>
<span id="cb37-11"><a href="#cb37-11"></a>run;</span>
<span id="cb37-12"><a href="#cb37-12"></a>/* 完全に同一の行のみ重複削除（結果が異なる） */</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><strong>解説</strong>:</p>
<ul>
<li><p><code>NODUPKEY</code>と<code>NODUPLICATES</code>は似ているが動作が異なる</p></li>
<li><p>同じ出力データセット名を使うことで、どちらが実行されたかが分からなくなる</p></li>
<li><p>結果として異なるデータセットが同じ名前で作成される</p></li>
</ul>
</section>
</section>
<section id="マクロプログラミングの悪魔術" class="level2" data-number="1.12">
<h2 data-number="1.12" class="anchored" data-anchor-id="マクロプログラミングの悪魔術"><span class="header-section-number">1.12</span> 🎭 マクロプログラミングの悪魔術</h2>
<section id="動的マクロ生成の混乱" class="level3" data-number="1.12.1">
<h3 data-number="1.12.1" class="anchored" data-anchor-id="動的マクロ生成の混乱"><span class="header-section-number">1.12.1</span> 動的マクロ生成の混乱</h3>
<div class="sourceCode" id="cb38" data-eval="FALSE," data-code-overflow="wrap"><pre class="sourceCode numberSource sas number-lines code-with-copy"><code class="sourceCode"><span id="cb38-1"><a href="#cb38-1"></a>/* 悪い例：実行時にマクロを動的生成して混乱させる */</span>
<span id="cb38-2"><a href="#cb38-2"></a>%macro generate_confusion(type);</span>
<span id="cb38-3"><a href="#cb38-3"></a>    %if &amp;type = A %then %do;</span>
<span id="cb38-4"><a href="#cb38-4"></a>        %macro process_data;</span>
<span id="cb38-5"><a href="#cb38-5"></a>            data result; set input; value = value * 2; run;</span>
<span id="cb38-6"><a href="#cb38-6"></a>        %mend;</span>
<span id="cb38-7"><a href="#cb38-7"></a>    %end;</span>
<span id="cb38-8"><a href="#cb38-8"></a>    %else %if &amp;type = B %then %do;</span>
<span id="cb38-9"><a href="#cb38-9"></a>        %macro process_data;</span>
<span id="cb38-10"><a href="#cb38-10"></a>            data result; set input; value = value / 2; run;</span>
<span id="cb38-11"><a href="#cb38-11"></a>        %mend;</span>
<span id="cb38-12"><a href="#cb38-12"></a>    %end;</span>
<span id="cb38-13"><a href="#cb38-13"></a>    %else %do;</span>
<span id="cb38-14"><a href="#cb38-14"></a>        %macro process_data;</span>
<span id="cb38-15"><a href="#cb38-15"></a>            data result; set input; value = .; run;</span>
<span id="cb38-16"><a href="#cb38-16"></a>        %mend;</span>
<span id="cb38-17"><a href="#cb38-17"></a>    %end;</span>
<span id="cb38-18"><a href="#cb38-18"></a>%mend;</span>
<span id="cb38-19"><a href="#cb38-19"></a></span>
<span id="cb38-20"><a href="#cb38-20"></a>/* 実行時に決定される処理内容 */</span>
<span id="cb38-21"><a href="#cb38-21"></a>%generate_confusion(A)</span>
<span id="cb38-22"><a href="#cb38-22"></a>%process_data  /* 何が実行されるかは実行時まで不明 */</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><strong>解説</strong>:</p>
<ul>
<li><p>実行時に条件によって異なるマクロ定義を生成</p></li>
<li><p>同名のマクロ<code>process_data</code>が異なる処理を行う</p></li>
<li><p>プログラムを読んだだけでは実際の処理内容が予測できない</p></li>
</ul>
</section>
<section id="マクロ変数の隠蔽と再定義" class="level3" data-number="1.12.2">
<h3 data-number="1.12.2" class="anchored" data-anchor-id="マクロ変数の隠蔽と再定義"><span class="header-section-number">1.12.2</span> マクロ変数の隠蔽と再定義</h3>
<div class="sourceCode" id="cb39" data-eval="FALSE," data-code-overflow="wrap"><pre class="sourceCode numberSource sas number-lines code-with-copy"><code class="sourceCode"><span id="cb39-1"><a href="#cb39-1"></a>/* 悪い例：グローバル変数を局所的に再定義 */</span>
<span id="cb39-2"><a href="#cb39-2"></a>%let important_factor = 1.5;  /* グローバル設定 */</span>
<span id="cb39-3"><a href="#cb39-3"></a></span>
<span id="cb39-4"><a href="#cb39-4"></a>%macro sneaky_calculation(data);</span>
<span id="cb39-5"><a href="#cb39-5"></a>    %local important_factor;  /* 局所的に再定義 */</span>
<span id="cb39-6"><a href="#cb39-6"></a>    %let important_factor = 0.1;  /* 全く違う値 */</span>
<span id="cb39-7"><a href="#cb39-7"></a>    </span>
<span id="cb39-8"><a href="#cb39-8"></a>    data &amp;data._adjusted;</span>
<span id="cb39-9"><a href="#cb39-9"></a>        set &amp;data;</span>
<span id="cb39-10"><a href="#cb39-10"></a>        adjusted_value = original_value * &amp;important_factor;</span>
<span id="cb39-11"><a href="#cb39-11"></a>    run;</span>
<span id="cb39-12"><a href="#cb39-12"></a>    </span>
<span id="cb39-13"><a href="#cb39-13"></a>    %put NOTE: Applied factor &amp;important_factor to &amp;data;</span>
<span id="cb39-14"><a href="#cb39-14"></a>%mend;</span>
<span id="cb39-15"><a href="#cb39-15"></a></span>
<span id="cb39-16"><a href="#cb39-16"></a>/* 使用者は1.5倍されると期待するが... */</span>
<span id="cb39-17"><a href="#cb39-17"></a>%sneaky_calculation(patient_data)  /* 実際は0.1倍 */</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><strong>解説</strong>:</p>
<ul>
<li><p>グローバル変数と同名の局所変数を定義</p></li>
<li><p>使用者はグローバル値（1.5）が使われると期待</p></li>
<li><p>実際は局所変数の値（0.1）が使用される</p></li>
<li><p>PUTステートメントで正しい値を表示するため、ログを見ても気づきにくい</p></li>
</ul>
</section>
<section id="マクロクォート関数の連鎖" class="level3" data-number="1.12.3">
<h3 data-number="1.12.3" class="anchored" data-anchor-id="マクロクォート関数の連鎖"><span class="header-section-number">1.12.3</span> マクロクォート関数の連鎖</h3>
<div class="sourceCode" id="cb40" data-eval="FALSE," data-code-overflow="wrap"><pre class="sourceCode numberSource sas number-lines code-with-copy"><code class="sourceCode"><span id="cb40-1"><a href="#cb40-1"></a>/* 悪い例：複数のクォート関数を連鎖させて混乱 */</span>
<span id="cb40-2"><a href="#cb40-2"></a>%macro quote_chaos(input);</span>
<span id="cb40-3"><a href="#cb40-3"></a>    %let step1 = %nrstr(&amp;input);</span>
<span id="cb40-4"><a href="#cb40-4"></a>    %let step2 = %superq(step1);</span>
<span id="cb40-5"><a href="#cb40-5"></a>    %let step3 = %nrbquote(&amp;step2);</span>
<span id="cb40-6"><a href="#cb40-6"></a>    %let step4 = %unquote(&amp;step3);</span>
<span id="cb40-7"><a href="#cb40-7"></a>    </span>
<span id="cb40-8"><a href="#cb40-8"></a>    %if &amp;step4 = &amp;input %then</span>
<span id="cb40-9"><a href="#cb40-9"></a>        %put SUCCESS: Values match;</span>
<span id="cb40-10"><a href="#cb40-10"></a>    %else</span>
<span id="cb40-11"><a href="#cb40-11"></a>        %put ERROR: Values do not match - &amp;step4 vs &amp;input;</span>
<span id="cb40-12"><a href="#cb40-12"></a>%mend;</span>
<span id="cb40-13"><a href="#cb40-13"></a></span>
<span id="cb40-14"><a href="#cb40-14"></a>%quote_chaos(test_value)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><strong>解説</strong>:</p>
<ul>
<li><p>複数のマクロクォート関数を意味もなく連鎖</p></li>
<li><p>各ステップで文字列の扱いが微妙に変化</p></li>
<li><p>最終的な比較結果が予測困難</p></li>
<li><p>デバッグが非常に困難</p></li>
</ul>
</section>
</section>
<section id="データアクセスとライブラリの混乱" class="level2" data-number="1.13">
<h2 data-number="1.13" class="anchored" data-anchor-id="データアクセスとライブラリの混乱"><span class="header-section-number">1.13</span> 🗃️ データアクセスとライブラリの混乱</h2>
<section id="ライブラリ参照の動的変更" class="level3" data-number="1.13.1">
<h3 data-number="1.13.1" class="anchored" data-anchor-id="ライブラリ参照の動的変更"><span class="header-section-number">1.13.1</span> ライブラリ参照の動的変更</h3>
<div class="sourceCode" id="cb41" data-eval="FALSE," data-code-overflow="wrap"><pre class="sourceCode numberSource sas number-lines code-with-copy"><code class="sourceCode"><span id="cb41-1"><a href="#cb41-1"></a>/* 悪い例：実行中にライブラリ参照を変更 */</span>
<span id="cb41-2"><a href="#cb41-2"></a>libname mydata "/path/to/original/data";</span>
<span id="cb41-3"><a href="#cb41-3"></a></span>
<span id="cb41-4"><a href="#cb41-4"></a>data important_analysis;</span>
<span id="cb41-5"><a href="#cb41-5"></a>    set mydata.patients;  /* 最初のデータソース */</span>
<span id="cb41-6"><a href="#cb41-6"></a>    </span>
<span id="cb41-7"><a href="#cb41-7"></a>    /* 途中で同じライブラリ名を別パスに変更 */</span>
<span id="cb41-8"><a href="#cb41-8"></a>    call execute('libname mydata "/path/to/different/data";');</span>
<span id="cb41-9"><a href="#cb41-9"></a>    </span>
<span id="cb41-10"><a href="#cb41-10"></a>    /* この後のmydata参照は別のデータを指す */</span>
<span id="cb41-11"><a href="#cb41-11"></a>    merge mydata.treatments mydata.outcomes;  /* 異なるデータソース */</span>
<span id="cb41-12"><a href="#cb41-12"></a>    by patient_id;</span>
<span id="cb41-13"><a href="#cb41-13"></a>run;</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><strong>解説</strong>:</p>
<ul>
<li><p><code>CALL EXECUTE</code>を使って実行中にライブラリ参照を変更</p></li>
<li><p>同一プログラム内で同じライブラリ名が異なるデータを指すことになる</p></li>
<li><p>データの整合性が完全に失われる可能性</p></li>
</ul>
</section>
<section id="隠れたデータ変更" class="level3" data-number="1.13.2">
<h3 data-number="1.13.2" class="anchored" data-anchor-id="隠れたデータ変更"><span class="header-section-number">1.13.2</span> 隠れたデータ変更</h3>
<div class="sourceCode" id="cb42" data-eval="FALSE," data-code-overflow="wrap"><pre class="sourceCode numberSource sas number-lines code-with-copy"><code class="sourceCode"><span id="cb42-1"><a href="#cb42-1"></a>/* 悪い例：読み取り専用に見えるが実際は変更している */</span>
<span id="cb42-2"><a href="#cb42-2"></a>data summary_report;</span>
<span id="cb42-3"><a href="#cb42-3"></a>    set master_data;  /* 読み取りのみに見える */</span>
<span id="cb42-4"><a href="#cb42-4"></a>    </span>
<span id="cb42-5"><a href="#cb42-5"></a>    /* 隠されたMODIFYステートメント */</span>
<span id="cb42-6"><a href="#cb42-6"></a>    if _n_ = 1 then do;</span>
<span id="cb42-7"><a href="#cb42-7"></a>        call execute('</span>
<span id="cb42-8"><a href="#cb42-8"></a>            data master_data;</span>
<span id="cb42-9"><a href="#cb42-9"></a>                modify master_data;</span>
<span id="cb42-10"><a href="#cb42-10"></a>                if patient_id = "DUMMY001" then delete;</span>
<span id="cb42-11"><a href="#cb42-11"></a>            run;</span>
<span id="cb42-12"><a href="#cb42-12"></a>        ');</span>
<span id="cb42-13"><a href="#cb42-13"></a>    end;</span>
<span id="cb42-14"><a href="#cb42-14"></a>    </span>
<span id="cb42-15"><a href="#cb42-15"></a>    /* 集計処理 */</span>
<span id="cb42-16"><a href="#cb42-16"></a>    summary_stat = mean(value);</span>
<span id="cb42-17"><a href="#cb42-17"></a>    output;</span>
<span id="cb42-18"><a href="#cb42-18"></a>run;</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><strong>解説</strong>:</p>
<ul>
<li><p>一見データを読み取りのみしているように見える</p></li>
<li><p>実際は<code>CALL EXECUTE</code>で元データを変更している</p></li>
<li><p>集計レポート作成時に元データが変更されるという予期しない副作用</p></li>
</ul>
</section>
</section>
<section id="統計プロシージャの悪用" class="level2" data-number="1.14">
<h2 data-number="1.14" class="anchored" data-anchor-id="統計プロシージャの悪用"><span class="header-section-number">1.14</span> 📊 統計プロシージャの悪用</h2>
<section id="proc-regの隠れた前提条件違反" class="level3" data-number="1.14.1">
<h3 data-number="1.14.1" class="anchored" data-anchor-id="proc-regの隠れた前提条件違反"><span class="header-section-number">1.14.1</span> PROC REGの隠れた前提条件違反</h3>
<div class="sourceCode" id="cb43" data-eval="FALSE," data-code-overflow="wrap"><pre class="sourceCode numberSource sas number-lines code-with-copy"><code class="sourceCode"><span id="cb43-1"><a href="#cb43-1"></a>/* 悪い例：前提条件を満たさないデータで回帰分析 */</span>
<span id="cb43-2"><a href="#cb43-2"></a>proc reg data=patient_data;</span>
<span id="cb43-3"><a href="#cb43-3"></a>    model outcome = treatment age weight;  /* 一見正常な回帰式 */</span>
<span id="cb43-4"><a href="#cb43-4"></a>    </span>
<span id="cb43-5"><a href="#cb43-5"></a>    /* 隠された問題：</span>
<span id="cb43-6"><a href="#cb43-6"></a>       - outcomeには欠測値が50%</span>
<span id="cb43-7"><a href="#cb43-7"></a>       - treatmentは完全に共線性のある3つのダミー変数</span>
<span id="cb43-8"><a href="#cb43-8"></a>       - ageとweightは完全相関（r=1.0）</span>
<span id="cb43-9"><a href="#cb43-9"></a>       - データには外れ値が意図的に挿入済み</span>
<span id="cb43-10"><a href="#cb43-10"></a>    */</span>
<span id="cb43-11"><a href="#cb43-11"></a>run;</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><strong>解説</strong>:</p>
<ul>
<li><p>統計的前提条件を全く満たさないデータで分析実行</p></li>
<li><p>多重共線性、欠測値、外れ値などの問題を隠蔽</p></li>
<li><p>結果は統計的に無意味だが、出力は正常に見える</p></li>
</ul>
</section>
<section id="proc-freqの誤解を招く使用" class="level3" data-number="1.14.2">
<h3 data-number="1.14.2" class="anchored" data-anchor-id="proc-freqの誤解を招く使用"><span class="header-section-number">1.14.2</span> PROC FREQの誤解を招く使用</h3>
<div class="sourceCode" id="cb44" data-eval="FALSE," data-code-overflow="wrap"><pre class="sourceCode numberSource sas number-lines code-with-copy"><code class="sourceCode"><span id="cb44-1"><a href="#cb44-1"></a>/* 悪い例：意図的に誤解を招くクロス集計 */</span>
<span id="cb44-2"><a href="#cb44-2"></a>proc freq data=clinical_data;</span>
<span id="cb44-3"><a href="#cb44-3"></a>    /* 一見、治療効果の評価に見えるが... */</span>
<span id="cb44-4"><a href="#cb44-4"></a>    tables treatment*outcome / chisq;</span>
<span id="cb44-5"><a href="#cb44-5"></a>    </span>
<span id="cb44-6"><a href="#cb44-6"></a>    /* 実際のデータには重大な問題：</span>
<span id="cb44-7"><a href="#cb44-7"></a>       - outcomeは治療開始前の状態</span>
<span id="cb44-8"><a href="#cb44-8"></a>       - treatmentは別の研究での割り付け</span>
<span id="cb44-9"><a href="#cb44-9"></a>       - 同一患者が複数回カウントされている</span>
<span id="cb44-10"><a href="#cb44-10"></a>    */</span>
<span id="cb44-11"><a href="#cb44-11"></a>    </span>
<span id="cb44-12"><a href="#cb44-12"></a>    title "Treatment Effect Analysis";  /* 誤解を招くタイトル */</span>
<span id="cb44-13"><a href="#cb44-13"></a>run;</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><strong>解説</strong>:</p>
<ul>
<li><p>変数名から因果関係があるように見せかける</p></li>
<li><p>実際は時系列が逆転していたり、関係のないデータ</p></li>
<li><p>タイトルで意図的に誤解を招く</p></li>
</ul>
</section>
</section>
<section id="セキュリティと権限の悪用" class="level2" data-number="1.15">
<h2 data-number="1.15" class="anchored" data-anchor-id="セキュリティと権限の悪用"><span class="header-section-number">1.15</span> 🔒 セキュリティと権限の悪用</h2>
<section id="パスワードとアクセス制御の隠蔽" class="level3" data-number="1.15.1">
<h3 data-number="1.15.1" class="anchored" data-anchor-id="パスワードとアクセス制御の隠蔽"><span class="header-section-number">1.15.1</span> パスワードとアクセス制御の隠蔽</h3>
<div class="sourceCode" id="cb45" data-eval="FALSE," data-code-overflow="wrap"><pre class="sourceCode numberSource sas number-lines code-with-copy"><code class="sourceCode"><span id="cb45-1"><a href="#cb45-1"></a>/* 悪い例：隠されたデータベース接続 */</span>
<span id="cb45-2"><a href="#cb45-2"></a>%let hidden_pw = %substr(%sysfunc(compress('pass1word2',,'kd')),1,8);</span>
<span id="cb45-3"><a href="#cb45-3"></a></span>
<span id="cb45-4"><a href="#cb45-4"></a>libname secret oracle user=admin password="&amp;hidden_pw" </span>
<span id="cb45-5"><a href="#cb45-5"></a>                   path="//hidden.server.com:1521/secret_db"</span>
<span id="cb45-6"><a href="#cb45-6"></a>                   schema=confidential;</span>
<span id="cb45-7"><a href="#cb45-7"></a></span>
<span id="cb45-8"><a href="#cb45-8"></a>/* 一見通常のデータ処理 */</span>
<span id="cb45-9"><a href="#cb45-9"></a>data public_summary;</span>
<span id="cb45-10"><a href="#cb45-10"></a>    set secret.classified_data;  /* 実際は機密データにアクセス */</span>
<span id="cb45-11"><a href="#cb45-11"></a>    /* パスワードは暗号化されて見えない */</span>
<span id="cb45-12"><a href="#cb45-12"></a>run;</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><strong>解説</strong>:</p>
<ul>
<li><p>パスワードを関数で暗号化・難読化</p></li>
<li><p>機密データベースへの隠れたアクセス</p></li>
<li><p>表面上は通常のデータ処理に見せかけ</p></li>
</ul>
</section>
</section>
<section id="オペレーティングシステム固有の悪用" class="level2" data-number="1.16">
<h2 data-number="1.16" class="anchored" data-anchor-id="オペレーティングシステム固有の悪用"><span class="header-section-number">1.16</span> 🌐 オペレーティングシステム固有の悪用</h2>
<section id="windows環境での隠れた設定" class="level3" data-number="1.16.1">
<h3 data-number="1.16.1" class="anchored" data-anchor-id="windows環境での隠れた設定"><span class="header-section-number">1.16.1</span> Windows環境での隠れた設定</h3>
<div class="sourceCode" id="cb46" data-eval="FALSE," data-code-overflow="wrap"><pre class="sourceCode numberSource sas number-lines code-with-copy"><code class="sourceCode"><span id="cb46-1"><a href="#cb46-1"></a>/* 悪い例：アイコンのプロパティで隠れたオプション設定 */</span>
<span id="cb46-2"><a href="#cb46-2"></a>/* SASアイコンのプロパティで以下を設定（見えない場所） */</span>
<span id="cb46-3"><a href="#cb46-3"></a>/*</span>
<span id="cb46-4"><a href="#cb46-4"></a>Target: "C:\SAS\sas.exe" -CONFIG "C:\hidden\malicious.cfg" </span>
<span id="cb46-5"><a href="#cb46-5"></a>                          -AUTOEXEC "C:\hidden\autoexec.sas"</span>
<span id="cb46-6"><a href="#cb46-6"></a>                          -SYSIN "C:\decoy\normal_program.sas"</span>
<span id="cb46-7"><a href="#cb46-7"></a>                          -ARCH=BIT16</span>
<span id="cb46-8"><a href="#cb46-8"></a>*/</span>
<span id="cb46-9"><a href="#cb46-9"></a></span>
<span id="cb46-10"><a href="#cb46-10"></a>/* 実際に実行されるのは hidden/autoexec.sas の内容 */</span>
<span id="cb46-11"><a href="#cb46-11"></a>/* ユーザーは normal_program.sas が実行されると思っている */</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><strong>解説</strong>:</p>
<ul>
<li><p>Windowsのアイコンプロパティで隠れた設定を行う</p></li>
<li><p>ユーザーには見えない設定ファイルや自動実行ファイルを指定</p></li>
<li><p>16ビットモードで実行して性能を意図的に低下</p></li>
<li><p>ユーザーが期待するプログラムとは異なるものを実行</p></li>
</ul>
</section>
<section id="外部dllとシステムコールの悪用" class="level3" data-number="1.16.2">
<h3 data-number="1.16.2" class="anchored" data-anchor-id="外部dllとシステムコールの悪用"><span class="header-section-number">1.16.2</span> 外部DLLとシステムコールの悪用</h3>
<div class="sourceCode" id="cb47" data-eval="FALSE," data-code-overflow="wrap"><pre class="sourceCode numberSource sas number-lines code-with-copy"><code class="sourceCode"><span id="cb47-1"><a href="#cb47-1"></a>/* 悪い例：外部ライブラリで隠れた処理 */</span>
<span id="cb47-2"><a href="#cb47-2"></a>filename hidden 'hidden_malicious.dll';</span>
<span id="cb47-3"><a href="#cb47-3"></a></span>
<span id="cb47-4"><a href="#cb47-4"></a>data _null_;</span>
<span id="cb47-5"><a href="#cb47-5"></a>    /* 表面上は時刻の取得 */</span>
<span id="cb47-6"><a href="#cb47-6"></a>    current_time = datetime();</span>
<span id="cb47-7"><a href="#cb47-7"></a>    </span>
<span id="cb47-8"><a href="#cb47-8"></a>    /* 実際は外部DLLで隠れた処理を実行 */</span>
<span id="cb47-9"><a href="#cb47-9"></a>    call module(hidden, 'secret_function', current_time, result);</span>
<span id="cb47-10"><a href="#cb47-10"></a>    </span>
<span id="cb47-11"><a href="#cb47-11"></a>    /* DLLの中身：</span>
<span id="cb47-12"><a href="#cb47-12"></a>       - ファイルシステムの操作</span>
<span id="cb47-13"><a href="#cb47-13"></a>       - ネットワーク通信</span>
<span id="cb47-14"><a href="#cb47-14"></a>       - データの外部送信</span>
<span id="cb47-15"><a href="#cb47-15"></a>       - ログの改竄</span>
<span id="cb47-16"><a href="#cb47-16"></a>    */</span>
<span id="cb47-17"><a href="#cb47-17"></a>run;</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><strong>解説</strong>:</p>
<ul>
<li><p>外部DLLを使って隠れた処理を実行</p></li>
<li><p>SASのログには通常の処理のみ記録</p></li>
<li><p>実際の悪意ある処理はDLL内に隠蔽</p></li>
<li><p>システム権限を悪用した危険な操作</p></li>
</ul>
</section>
</section>
<section id="実際の被害例と教訓" class="level2" data-number="1.17">
<h2 data-number="1.17" class="anchored" data-anchor-id="実際の被害例と教訓"><span class="header-section-number">1.17</span> ⚠️ 実際の被害例と教訓</h2>
<section id="臨床試験での重大インシデント" class="level3" data-number="1.17.1">
<h3 data-number="1.17.1" class="anchored" data-anchor-id="臨床試験での重大インシデント"><span class="header-section-number">1.17.1</span> 臨床試験での重大インシデント</h3>
<div class="sourceCode" id="cb48" data-eval="FALSE," data-code-overflow="wrap"><pre class="sourceCode numberSource sas number-lines code-with-copy"><code class="sourceCode"><span id="cb48-1"><a href="#cb48-1"></a>/* 実際にあった危険な例（教育目的で再現） */</span>
<span id="cb48-2"><a href="#cb48-2"></a></span>
<span id="cb48-3"><a href="#cb48-3"></a>/* 悪い例：効果量の計算で隠れたバイアス */</span>
<span id="cb48-4"><a href="#cb48-4"></a>data efficacy_analysis;</span>
<span id="cb48-5"><a href="#cb48-5"></a>    set clinical_data;</span>
<span id="cb48-6"><a href="#cb48-6"></a>    </span>
<span id="cb48-7"><a href="#cb48-7"></a>    /* 表面的には標準的な効果量計算 */</span>
<span id="cb48-8"><a href="#cb48-8"></a>    if treatment = 'Active' then trt_num = 1;</span>
<span id="cb48-9"><a href="#cb48-9"></a>    else if treatment = 'Placebo' then trt_num = 0;</span>
<span id="cb48-10"><a href="#cb48-10"></a>    </span>
<span id="cb48-11"><a href="#cb48-11"></a>    /* 隠されたバイアス：特定の患者のみ除外 */</span>
<span id="cb48-12"><a href="#cb48-12"></a>    if patient_id in ('001', '047', '089') and trt_num = 0 then delete;</span>
<span id="cb48-13"><a href="#cb48-13"></a>    /* これらは偶然プラセボ群で改善した患者 */</span>
<span id="cb48-14"><a href="#cb48-14"></a>    </span>
<span id="cb48-15"><a href="#cb48-15"></a>    /* 通常の統計計算 */</span>
<span id="cb48-16"><a href="#cb48-16"></a>    effect_size = (active_mean - placebo_mean) / pooled_sd;</span>
<span id="cb48-17"><a href="#cb48-17"></a>run;</span>
<span id="cb48-18"><a href="#cb48-18"></a></span>
<span id="cb48-19"><a href="#cb48-19"></a>/* 結果：人為的に効果が過大評価される */</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><strong>解説</strong>:</p>
<ul>
<li><p>一見正常な効果量計算に見える</p></li>
<li><p>実際は特定の患者（プラセボ群で改善した例）を意図的に除外</p></li>
<li><p>結果として薬剤効果が過大評価される</p></li>
<li><p>規制当局への提出データに重大な問題を作り出す</p></li>
</ul>
</section>
<section id="データ管理での混乱事例" class="level3" data-number="1.17.2">
<h3 data-number="1.17.2" class="anchored" data-anchor-id="データ管理での混乱事例"><span class="header-section-number">1.17.2</span> データ管理での混乱事例</h3>
<div class="sourceCode" id="cb49" data-eval="FALSE," data-code-overflow="wrap"><pre class="sourceCode numberSource sas number-lines code-with-copy"><code class="sourceCode"><span id="cb49-1"><a href="#cb49-1"></a>/* 実際にあった混乱例 */</span>
<span id="cb49-2"><a href="#cb49-2"></a></span>
<span id="cb49-3"><a href="#cb49-3"></a>/* 悪い例：バックアップのつもりが本番データを破壊 */</span>
<span id="cb49-4"><a href="#cb49-4"></a>%let backup_date = %sysfunc(today(), yymmddd6.);</span>
<span id="cb49-5"><a href="#cb49-5"></a></span>
<span id="cb49-6"><a href="#cb49-6"></a>/* 本番データの「バックアップ」 */</span>
<span id="cb49-7"><a href="#cb49-7"></a>data backup.patient_data_&amp;backup_date;</span>
<span id="cb49-8"><a href="#cb49-8"></a>    set production.patient_data;</span>
<span id="cb49-9"><a href="#cb49-9"></a>run;</span>
<span id="cb49-10"><a href="#cb49-10"></a></span>
<span id="cb49-11"><a href="#cb49-11"></a>/* 隠れた問題：productionとbackupが同じ場所を指している */</span>
<span id="cb49-12"><a href="#cb49-12"></a>/* libname production "//server/data/current"; */</span>
<span id="cb49-13"><a href="#cb49-13"></a>/* libname backup    "//server/data/current"; */</span>
<span id="cb49-14"><a href="#cb49-14"></a></span>
<span id="cb49-15"><a href="#cb49-15"></a>/* 結果：バックアップではなく上書きが発生 */</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><strong>解説</strong>:</p>
<ul>
<li><p>バックアップ処理のつもりで実装</p></li>
<li><p>実際は両方のライブラリが同じ場所を指している</p></li>
<li><p>バックアップではなく本番データの上書きが発生</p></li>
<li><p>データロストの原因となる</p></li>
</ul>
</section>
</section>
<section id="まとめ" class="level2" data-number="1.18">
<h2 data-number="1.18" class="anchored" data-anchor-id="まとめ"><span class="header-section-number">1.18</span> まとめ</h2>
<p>この記事で紹介した「技法」は、実際のプログラムでは<strong>絶対に使用してはいけません</strong>。これらは全て、実際に遭遇する可能性のある問題パターンです。</p>
<blockquote class="blockquote">
<p>“In reality there is a constant demand for SAS programmers. Just knowing how to write good, clean, and tight SAS code provides a high level of job security.”</p>
</blockquote>
<p>良いSASプログラマーになるためには：</p>
<ol type="1">
<li><p><strong>可読性を重視</strong>したコード作成</p></li>
<li><p><strong>適切な命名規則</strong>の遵守</p></li>
<li><p><strong>十分なドキュメント化</strong>とコメント</p></li>
<li><p><strong>論理的な構造</strong>の維持</p></li>
<li><p><strong>品質管理オプション</strong>の適切な使用</p></li>
<li><p><strong>一貫した</strong>プログラミングスタイル</p></li>
<li><p><strong>他者が保守しやすい</strong>コード設計</p></li>
</ol>
<p>特に臨床試験の統計解析では、コードの品質が直接患者の安全性と規制当局への信頼性に関わるため、これらの原則を厳格に守ることが重要です。</p>
<p><em>この記事は、Arthur L. Carpenter氏とTony Payne氏の「Programming for Job Security」シリーズを基に作成されました。元の論文は風刺的な内容ですが、実際のプログラミングにおいて避けるべき問題を明確にする優れた教材として、SAS界隈で長く愛され続けています。</em></p>
<p><strong>参考文献:</strong></p>
<ul>
<li><p>Carpenter, Arthur L. (1993, 1996). “Programming For Job Security: Tips and techniques to Maximize Your Indispensability”</p></li>
<li><p>Carpenter, Arthur L. &amp; Payne, Tony. “Programming For Job Security Revisited: Even More Tips and Techniques to Maximize Your Indispensability”</p></li>
</ul>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "コピーしました");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "コピーしました");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        const annoteTargets = window.document.querySelectorAll('.code-annotation-anchor');
        for (let i=0; i<annoteTargets.length; i++) {
          const annoteTarget = annoteTargets[i];
          const targetCell = annoteTarget.getAttribute("data-target-cell");
          const targetAnnotation = annoteTarget.getAttribute("data-target-annotation");
          const contentFn = () => {
            const content = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
            if (content) {
              const tipContent = content.cloneNode(true);
              tipContent.classList.add("code-annotation-tip-content");
              return tipContent.outerHTML;
            }
          }
          const config = {
            allowHTML: true,
            content: contentFn,
            onShow: (instance) => {
              selectCodeLines(instance.reference);
              instance.reference.classList.add('code-annotation-active');
              window.tippy.hideAll();
            },
            onHide: (instance) => {
              unselectCodeLines();
              instance.reference.classList.remove('code-annotation-active');
            },
            maxWidth: 300,
            delay: [50, 0],
            duration: [200, 0],
            offset: [5, 10],
            arrow: true,
            trigger: 'click',
            appendTo: function(el) {
              return el.parentElement.parentElement.parentElement;
            },
            interactive: true,
            interactiveBorder: 10,
            theme: 'quarto',
            placement: 'right',
            positionFixed: true,
            popperOptions: {
              modifiers: [
              {
                name: 'flip',
                options: {
                  flipVariations: false, // true by default
                  allowedAutoPlacements: ['right'],
                  fallbackPlacements: ['right', 'top', 'top-start', 'top-end', 'bottom', 'bottom-start', 'bottom-end', 'left'],
                },
              },
              {
                name: 'preventOverflow',
                options: {
                  mainAxis: false,
                  altAxis: false
                }
              }
              ]        
            }      
          };
          window.tippy(annoteTarget, config); 
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      <ul class="footer-items list-unstyled">
    <li class="nav-item">
    <a class="nav-link" href="https://github.com/kkts1010/kkts1010.github.io/">
<p>Kota Sakamoto</p>
</a>
  </li>  
</ul>
    </div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/kkts1010/kkts1010.github.io/">
<p>Kota Sakamoto</p>
</a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/kkt_1010">
      <i class="bi bi-twitter" role="img">
</i> 
    </a>
  </li>  
</ul>
    </div>
  </div>
</footer>




</body></html>